ì •ë§ ëŒ€ë‹¨í•©ë‹ˆë‹¤! ì´ì œ **'ì‚¬ê±´ì˜ ê·œëª¨ì™€ ê²°ê³¼'**ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë§ˆì§€ë§‰ í•µì‹¬ ë¡œì§ì¸ ì‚¼í•©/ë°©í•© êµ­(
å±€) í˜•ì„±ê³¼ ì‚¬ê±´ ê°•ë„ ê³µì‹ íŠœë‹ì„ í†µí•©í•˜ì—¬ ê·œì¹™ ê¸°ë°˜(Rule-Based) SAJU ë§ˆìŠ¤í„° ì—”ì§„ì„
ìµœì¢…ì ìœ¼ë¡œ ì™„ì„±í•˜ê² ìŠµë‹ˆë‹¤.
ì´ë¡œì¨ ì‹œìŠ¤í…œì€ **ìš´ì˜ ë°œìƒ (íƒ€ì´ë°), ë°œí˜„ ì¥ì†Œ (ìœ¡ì¹œ/ê¶ì„±), ê·¸ë¦¬ê³  ì‚¬ê±´ì˜ ê·œëª¨ (ì˜¤í–‰



ğŸ’» SAJU ë§ˆìŠ¤í„° ì‹œìŠ¤í…œ ìµœì¢… ì™„ì„± ì½”ë“œ (v7.0)
êµ­)**ê¹Œì§€ ëª¨ë“  ê²ƒì„ ì •ëŸ‰ì ìœ¼ë¡œ ì˜ˆì¸¡í•˜ê²Œ ë©ë‹ˆë‹¤.




1. ìƒìˆ˜ ì •ì˜ ë³´ê°• (ì‚¼í•©/ë°©í•© ë° ì˜¤í–‰ êµ­(å±€) ì¶”ê°€)
import randomâ€‹
from collections import defaultdictâ€‹
from typing import Dict, List, Anyâ€‹
â€‹
#
======================================================================
========â€‹
# 1. ëª…ë¦¬í•™ ê¸°ë³¸ ìƒìˆ˜ ì •ì˜ (ì§€ì¥ê°„ ì •ë°€ë„, í•©í™” ì¡°ê±´, í˜•ì¶© ê°€ì¤‘ì¹˜, íƒ€ì´ë°,
ì‚¼í•©/ë°©í•© ë°˜ì˜)â€‹
#
======================================================================
========â€‹
â€‹
SAJU_CONSTANTS = {â€‹
    'OHANG': {'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ',
'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´',â€‹
               'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ',
'å·³': 'ç«', 'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', '
äº¥': 'æ°´'},â€‹
    â€‹
    # ìŒì–‘ ìƒìˆ˜â€‹
    'YIN_YANG': {'ç”²': 'é™½', 'ä¹™': 'é™°', 'ä¸™': 'é™½', 'ä¸': 'é™°', 'æˆŠ': '
é™½', 'å·±': 'é™°', 'åºš': 'é™½', 'è¾›': 'é™°', 'å£¬': 'é™½', 'ç™¸': 'é™°',â€‹
                 'å­': 'é™°', 'ä¸‘': 'é™°', 'å¯…': 'é™½', 'å¯': 'é™°', 'è¾°': '
é™½', 'å·³': 'é™°', 'åˆ': 'é™½', 'æœª': 'é™°', 'ç”³': 'é™½', 'é…‰': 'é™°', 'æˆŒ': 'é™½
', 'äº¥': 'é™°'},â€‹
    â€‹
    # ì§€ì¥ê°„: [ì´ˆê¸°, ì¤‘ê¸°, ì •ê¸°]â€‹
    'HIDDEN_STEMS': {'å­': ['å£¬', 'ç™¸'], 'ä¸‘': ['ç™¸', 'è¾›', 'å·±'], 'å¯…':
['æˆŠ', 'ä¸™', 'ç”²'], 'å¯': ['ç”²', 'ä¹™'], â€‹
                     'è¾°': ['ä¹™', 'ç™¸', 'æˆŠ'], 'å·³': ['æˆŠ', 'åºš', 'ä¸™'],
'åˆ': ['ä¸™', 'å·±', 'ä¸'], 'æœª': ['ä¸', 'ä¹™', 'å·±'], â€‹
                     'ç”³': ['æˆŠ', 'å£¬', 'åºš'], 'é…‰': ['åºš', 'è¾›'], 'æˆŒ':
['è¾›', 'ä¸', 'æˆŠ'], 'äº¥': ['æˆŠ', 'ç”²', 'å£¬']},â€‹
â€‹
    # ì›”ë¥ ë¶„ì•¼ ë¹„ìœ¨ (ì§€ì¥ê°„ ê¸°ìš´ì˜ ì •ëŸ‰í™” ê¸°ë°˜: 30ì¼ ê¸°ì¤€)â€‹
    'HIDDEN_STEMS_RATIO': {â€‹
        'å¯…': [7/30, 7/30, 16/30], 'ç”³': [7/30, 7/30, 16/30], 'å·³':
[7/30, 7/30, 16/30], 'äº¥': [7/30, 7/30, 16/30], â€‹
        'å¯': [10/30, 0, 20/30], 'é…‰': [10/30, 0, 20/30], 'å­': [10/30,
0, 20/30], â€‹
        'åˆ': [10/30, 9/30, 11/30], â€‹
        'è¾°': [9/30, 3/30, 18/30], 'æˆŒ': [9/30, 3/30, 18/30], 'ä¸‘':
[9/30, 3/30, 18/30], 'æœª': [9/30, 3/30, 18/30], â€‹
    },â€‹
    â€‹
    # ì²œê°„ ê¸€ìì˜ í†µê·¼ì²˜ â€‹
    'TONGGEUN_PLACES': { â€‹
        'ç”²': ['å¯…', 'å¯', 'è¾°', 'äº¥'], 'ä¹™': ['å¯…', 'å¯', 'æœª'], 'ä¸™':
['å·³', 'åˆ', 'æˆŒ', 'å¯…'], 'ä¸': ['å·³', 'åˆ', 'æœª'],â€‹
        'æˆŠ': ['è¾°', 'æˆŒ', 'ä¸‘', 'æœª', 'å·³'], 'å·±': ['è¾°', 'æˆŒ', 'ä¸‘', 'æœª
', 'åˆ'], 'åºš': ['ç”³', 'é…‰', 'ä¸‘', 'å·³'],â€‹
        'è¾›': ['ç”³', 'é…‰', 'æˆŒ'], 'å£¬': ['äº¥', 'å­', 'ç”³'], 'ç™¸': ['äº¥',
'å­', 'è¾°']â€‹
    },â€‹
    â€‹
    # ì˜¤í–‰ ìƒê·¹/ìƒìƒ ê´€ê³„â€‹
    'SANGGEUK': {'æœ¨': 'åœŸ', 'åœŸ': 'æ°´', 'æ°´': 'ç«', 'ç«': 'é‡‘', 'é‡‘': '
æœ¨'}, â€‹
    'SANGSAENG': {'æœ¨': 'ç«', 'ç«': 'åœŸ', 'åœŸ': 'é‡‘', 'é‡‘': 'æ°´', 'æ°´': '
æœ¨'}, â€‹
    'SANGSAENG_REVERSE': {'æœ¨': 'æ°´', 'ç«': 'æœ¨', 'åœŸ': 'ç«', 'é‡‘': 'åœŸ',
'æ°´': 'é‡‘'}, â€‹
    â€‹
    # ì§€ì§€ ì¶© ëª©ë¡â€‹
    'JICHE_CHUNG': {'å­': 'åˆ', 'ä¸‘': 'æœª', 'å¯…': 'ç”³', 'å¯': 'é…‰', 'è¾°':
'æˆŒ', 'å·³': 'äº¥', 'åˆ': 'å­', 'æœª': 'ä¸‘', 'ç”³': 'å¯…', 'é…‰': 'å¯', 'æˆŒ': '
è¾°', 'äº¥': 'å·³'},â€‹
    â€‹
    # ì²œê°„í•©(åˆåŒ–) ì„±ë¦½ ì¡°ê±´ ë° ì˜¤í–‰ (ì‚¼ëª…í†µíšŒ ê¸°ë°˜)â€‹
    'CHEONGAN_HEHUA': { â€‹
        ('ç”²', 'å·±'): ['åœŸ', 'åœŸ', ['è¾°', 'æˆŒ', 'ä¸‘', 'æœª']], # ê°‘ê¸°í•©í† â€‹
        ('ä¹™', 'åºš'): ['é‡‘', 'é‡‘', ['ç”³', 'é…‰', 'ä¸‘']],         # ì„ê²½í•©ê¸ˆâ€‹
        ('ä¸™', 'è¾›'): ['æ°´', 'æ°´', ['äº¥', 'å­', 'è¾°']],         # ë³‘ì‹ í•©ìˆ˜â€‹
        ('ä¸', 'å£¬'): ['æœ¨', 'æœ¨', ['å¯…', 'å¯', 'äº¥']],         # ì •ì„í•©ëª©â€‹
        ('æˆŠ', 'ç™¸'): ['ç«', 'ç«', ['å·³', 'åˆ', 'æˆŒ', 'æœª']], # ë¬´ê³„í•©í™”â€‹
    },â€‹
â€‹
    #ğŸŒŸ   ì§€ì§€ ì‚¼í•©/ë°©í•© ëª©ë¡ ë° ì˜¤í–‰ (ì‚¬ê±´ ê·œëª¨ ì˜ˆì¸¡)â€‹
    'JICHE_COMBINATIONS': {â€‹
        'SANHAP': {â€‹
             ('ç”³', 'å­', 'è¾°'): 'æ°´', ('äº¥', 'å¯', 'æœª'): 'æœ¨', â€‹
             ('å¯…', 'åˆ', 'æˆŒ'): 'ç«', ('å·³', 'é…‰', 'ä¸‘'): 'é‡‘',â€‹
        },â€‹
        'BANGHAP': {â€‹
               ('å¯…', 'å¯', 'è¾°'): 'æœ¨', ('å·³', 'åˆ', 'æœª'): 'ç«', â€‹
               ('ç”³', 'é…‰', 'æˆŒ'): 'é‡‘', ('äº¥', 'å­', 'ä¸‘'): 'æ°´',â€‹
          }â€‹
    },â€‹
â€‹
    # í˜•ì¶©íŒŒí•´ ìš°ì„ ìˆœìœ„ ê°€ì¤‘ì¹˜ (ì‚¬ê±´ ê°•ë„ ê³µì‹ Purity íŠœë‹)â€‹
    'INTERACTION_WEIGHTS': {â€‹
        'ì¶©(æ²–)': 1.4, â€‹
        'í•©(åˆ)': 1.0, â€‹
    },â€‹
    â€‹
    # 12ìš´ì„± (ì²œê°„ë³„ 12ì§€ì§€ ìƒíƒœ)â€‹
    'JIBYEON_12WUNSEONG': {â€‹
        'ç”²': {'å­': 'ëª©ìš•', 'ä¸‘': 'ê´€ëŒ€', 'å¯…': 'ê±´ë¡', 'å¯': 'ì œì™•', 'è¾°
': 'ì‡ ', 'å·³': 'ë³‘', 'åˆ': 'ì‚¬', 'æœª': 'ë¬˜', 'ç”³': 'ì ˆ', 'é…‰': 'íƒœ', 'æˆŒ':
'ì–‘', 'äº¥': 'ì¥ìƒ'},â€‹
        'ä¹™': {'å­': 'ë³‘', 'ä¸‘': 'ì‡ ', 'å¯…': 'ì œì™•', 'å¯': 'ê±´ë¡', 'è¾°':
'ê´€ëŒ€', 'å·³': 'ëª©ìš•', 'åˆ': 'ì¥ìƒ', 'æœª': 'ì–‘', 'ç”³': 'íƒœ', 'é…‰': 'ì ˆ', 'æˆŒ
': 'ë¬˜', 'äº¥': 'ì‚¬'},â€‹
        'ä¸™': {'å­': 'íƒœ', 'ä¸‘': 'ì–‘', 'å¯…': 'ì¥ìƒ', 'å¯': 'ëª©ìš•', 'è¾°':
'ê´€ëŒ€', 'å·³': 'ê±´ë¡', 'åˆ': 'ì œì™•', 'æœª': 'ì‡ ', 'ç”³': 'ë³‘', 'é…‰': 'ì‚¬', 'æˆŒ
': 'ë¬˜', 'äº¥': 'ì ˆ'},â€‹
        'ä¸': {'å­': 'ì ˆ', 'ä¸‘': 'ë¬˜', 'å¯…': 'íƒœ', 'å¯': 'ì–‘', 'è¾°':
'ì¥ìƒ', 'å·³': 'ëª©ìš•', 'åˆ': 'ê±´ë¡', 'æœª': 'ì œì™•', 'ç”³': 'ì‡ ', 'é…‰': 'ë³‘', '
æˆŒ': 'ì‚¬', 'äº¥': 'ë³‘'},â€‹
        'æˆŠ': {'å­': 'íƒœ', 'ä¸‘': 'ì–‘', 'å¯…': 'ì¥ìƒ', 'å¯': 'ëª©ìš•', 'è¾°':
'ê´€ëŒ€', 'å·³': 'ê±´ë¡', 'åˆ': 'ì œì™•', 'æœª': 'ì‡ ', 'ç”³': 'ë³‘', 'é…‰': 'ì‚¬', 'æˆŒ
': 'ë¬˜', 'äº¥': 'ì ˆ'},â€‹
        'å·±': {'å­': 'ì ˆ', 'ä¸‘': 'ë¬˜', 'å¯…': 'íƒœ', 'å¯': 'ì–‘', 'è¾°':
'ì¥ìƒ', 'å·³': 'ëª©ìš•', 'åˆ': 'ê±´ë¡', 'æœª': 'ì œì™•', 'ç”³': 'ì‡ ', 'é…‰': 'ë³‘', '
æˆŒ': 'ì‚¬', 'äº¥': 'ë³‘'},â€‹
        'åºš': {'å­': 'ì‚¬', 'ä¸‘': 'ë¬˜', 'å¯…': 'ì ˆ', 'å¯': 'íƒœ', 'è¾°': 'ì–‘',
'å·³': 'ì¥ìƒ', 'åˆ': 'ëª©ìš•', 'æœª': 'ê´€ëŒ€', 'ç”³': 'ê±´ë¡', 'é…‰': 'ì œì™•', 'æˆŒ':
'ì‡ ', 'äº¥': 'ë³‘'},â€‹
        'è¾›': {'å­': 'ì¥ìƒ', 'ä¸‘': 'ì–‘', 'å¯…': 'íƒœ', 'å¯': 'ì ˆ', 'è¾°':
'ë¬˜', 'å·³': 'ì‚¬', 'åˆ': 'ë³‘', 'æœª': 'ì‡ ', 'ç”³': 'ì œì™•', 'é…‰': 'ê±´ë¡', 'æˆŒ':
'ê´€ëŒ€', 'äº¥': 'ëª©ìš•'},â€‹
        'å£¬': {'å­': 'ì œì™•', 'ä¸‘': 'ì‡ ', 'å¯…': 'ë³‘', 'å¯': 'ì‚¬', 'è¾°':
'ë¬˜', 'å·³': 'ì ˆ', 'åˆ': 'íƒœ', 'æœª': 'ì–‘', 'ç”³': 'ì¥ìƒ', 'é…‰': 'ëª©ìš•', 'æˆŒ':
'ê´€ëŒ€', 'äº¥': 'ê±´ë¡'},â€‹
        'ç™¸': {'å­': 'ê±´ë¡', 'ä¸‘': 'ì œì™•', 'å¯…': 'ì‡ ', 'å¯': 'ë³‘', 'è¾°':
'ì‚¬', 'å·³': 'ë¬˜', 'åˆ': 'ì ˆ', 'æœª': 'íƒœ', 'ç”³': 'ì–‘', 'é…‰': 'ì¥ìƒ', 'æˆŒ':
'ëª©ìš•', 'äº¥': 'ê´€ëŒ€'},â€‹
    },â€‹
â€‹
    # ë³µìŒ/ë°˜ìŒ ë° 12ìš´ì„± ì¶©ê²©ë„ ê°€ì¤‘ì¹˜â€‹
    'TIMING_WEIGHTS': {â€‹
        'ë³µìŒ(ä¼åŸ)': 0.4, â€‹
       'ë°˜ìŒ(ååŸ)': 0.7, â€‹
       'ì œì™•/ê±´ë¡': 0.6, â€‹
       'ë¬˜/ì ˆ/ì‚¬': -0.4 â€‹
    },â€‹
    â€‹
    # ìœ¡ì¹œ ê¶ì„± ë§¤í•‘ (ì—°í•´ìí‰ ê¸°ë°˜)â€‹
    'LIOUCHIN_MAPPING': {â€‹
        'ê°€ì¡±/ë¶€ëª¨/í•™ë¬¸': {'ì‹­ì„±': ['ì¸ìˆ˜', 'í¸ì¸'], 'ê¶ì„±': ['ë…„', 'ì›”']},â€‹
        'ì§ì—…/ì‚¬íšŒ/í˜•ì œ': {'ì‹­ì„±': ['ì •ê´€', 'í¸ê´€', 'ë¹„ê²¬', 'ê²ì¬'], 'ê¶ì„±':
['ì›”']},â€‹
        'ë°°ìš°ì/íŒŒíŠ¸ë„ˆ/ì¬ë¬¼': {'ì‹­ì„±': ['ì •ì¬', 'í¸ì¬'], 'ê¶ì„±': ['ì¼']},â€‹
        'ìë…€/ê²°ê³¼/ë…¸ë…„': {'ì‹­ì„±': ['ì‹ì‹ ', 'ìƒê´€'], 'ê¶ì„±': ['ì‹œ']},â€‹
    },â€‹
    â€‹
    # ì˜¤í–‰-í–‰ë™ ì²˜ë°© ë§¤í•‘â€‹
    'OHANG_ACTION_GUIDANCE': {â€‹
        'æœ¨': 'êµìœ¡/í•™ë¬¸, ì´ˆë¡ìƒ‰ ê³„ì—´ ì˜·, ì•„ì¹¨ ì‚°ì±…',â€‹
        'ç«': 'ë°œí‘œ/ê²½ìŸ, ë¶‰ì€ìƒ‰/ì¡°ëª…, í–‡ë³• ì¬ê¸°',â€‹
        'åœŸ': 'ì¤‘ê°œ/ê³„ì•½, ë…¸ë€ìƒ‰/ê°ˆìƒ‰, í…ƒë°­ ê°€ê¾¸ê¸°',â€‹
        'é‡‘': 'ê·œìœ¨/ì •ë¦¬, í°ìƒ‰/ê¸ˆì† ì¥ì‹ êµ¬, ê³„íš ìˆ˜ë¦½',â€‹
        'æ°´': 'íƒêµ¬/ì‹¬ì¸µ, ê²€ì€ìƒ‰/íŒŒë€ìƒ‰, ëª…ìƒ ë° íœ´ì‹'â€‹
    },â€‹
    â€‹
    # ì¡°í›„ ìš©ì‹  í…Œì´ë¸”â€‹
    'JOHU_REQUIRED': {â€‹
        'å¯…': {'íŠ¹ì§•': 'ì´ˆë´„, å¯’æ°£ ì”ì¡´', 'í•„ìš”': ['ä¸™ç«', 'ç™¸æ°´']}, 'å¯':
{'íŠ¹ì§•': 'ë§Œì¶˜, æ¿•æ°£ ì¦ê°€', 'í•„ìš”': ['åºšé‡‘', 'ä¸ç«']}, â€‹
        'è¾°': {'íŠ¹ì§•': 'ëŠ¦ë´„, æ¿•í•˜ê³  åœŸ ê°•í•¨', 'í•„ìš”': ['ç”²æœ¨', 'å£¬æ°´']}, '
å·³': {'íŠ¹ì§•': 'ì´ˆì—¬ë¦„, æš‘æ°£ ì‹œì‘', 'í•„ìš”': ['å£¬æ°´', 'åºšé‡‘']}, â€‹
        'åˆ': {'íŠ¹ì§•': 'í•œì—¬ë¦„, ç‚ç†±', 'í•„ìš”': ['å£¬æ°´', 'åºšé‡‘']}, 'æœª':
{'íŠ¹ì§•': 'ëŠ¦ì—¬ë¦„, ç‡¥í•˜ê³  åœŸ ê°•í•¨', 'í•„ìš”': ['å£¬æ°´', 'ç”²æœ¨']}, â€‹
        'ç”³': {'íŠ¹ì§•': 'ì´ˆê°€ì„, æ¶¼æ°£ ì‹œì‘', 'í•„ìš”': ['ä¸ç«', 'ç”²æœ¨']}, 'é…‰
': {'íŠ¹ì§•': 'ë§Œì¶”, è‚…æ®ºì˜ ê¸°ìš´', 'í•„ìš”': ['ä¸™ç«', 'å£¬æ°´']}, â€‹
        'æˆŒ': {'íŠ¹ì§•': 'ëŠ¦ê°€ì„, ç‡¥í•˜ê³  åœŸ ê°•í•¨', 'í•„ìš”': ['ç”²æœ¨', 'å£¬æ°´']},
'äº¥': {'íŠ¹ì§•': 'ì´ˆê²¨ìš¸, å¯’æ°£ ì‹œì‘', 'í•„ìš”': ['ä¸™ç«', 'æˆŠåœŸ']}, â€‹
        'å­': {'íŠ¹ì§•': 'í•œê²¨ìš¸, é…·å¯’', 'í•„ìš”': ['ä¸™ç«', 'æˆŠåœŸ']}, 'ä¸‘':
{'íŠ¹ì§•': 'ëŠ¦ê²¨ìš¸, å‡åœŸ', 'í•„ìš”': ['ä¸™ç«', 'ç”²æœ¨']},â€‹
    },â€‹
    â€‹
    # í†µë³€ ì„œìˆ  í…œí”Œë¦¿â€‹
    'NARRATIVE_TEMPLATES': {â€‹
        # ... (ê¸°ì¡´ í…œí”Œë¦¿ ìœ ì§€) ...â€‹
                              ğŸ’¥
        'JICHE_CHUNG_NARRATIVE': "  **ì§€ì§€ì˜ ì¶© ë°œìƒ:** ëŒ€ìš´ ì§€ì§€
{daewun_ji}ê°€ ì›êµ­ ì§€ì§€ {natal_ji}ë¥¼ ì¶©í•˜ì—¬ **{affected_pilar}** ê¶ì„±(å®®
æ˜Ÿ)ì— **ê³ ê°•ë„ ë³€ë™ ì´ë²¤íŠ¸**ê°€ ë°œë™ë©ë‹ˆë‹¤. (ì¶©ê²©ë„ {score}ì , ê°€ì¤‘ì¹˜
{weight:.1f} ë°˜ì˜)",â€‹
                               ğŸ¤
        'CHEONGAN_HEHUA_SUCCESS': "  **ì²œê°„ í•©í™” ì„±ê³µ ({ohang} ë³€í™˜):**
ëŒ€ìš´ {gan1}ê³¼ ì›êµ­ {gan2}ì˜ í•©í™” ì„±ë¦½ë¥  {prob:.2f}ë¡œ ëŒ€ì„¸ì˜ ê¸°ì„¸ê°€
{ohang}ìœ¼ë¡œ ë³€í™”í•©ë‹ˆë‹¤.",â€‹
                          ğŸ”
        'TAIMING_BOGEUM': "   **ë³µìŒ(ä¼åŸ) ë°œë™:** ìš´ê³¼ ì›êµ­ì— ë™ì¼ ê°„ì§€ê°€
ì¶œí˜„í•˜ì—¬ ì‚¬ê±´ì´ **ë˜í’€ì´/ê³ ì°©**ë˜ëŠ” ì–‘ìƒì„ ë³´ì…ë‹ˆë‹¤. (ê°•ë„ {weight:.1f}ë°°
ê°€ì¤‘)",â€‹
                          ğŸ¯
        'LIOUCHIN_EVENT': "   **{area} ì˜ì—­ ì‚¬ê±´ íƒœê·¸:**
{main_tenshin}({ten_god})ì´ **{palace}** ê¶ì„±ì—ì„œ ë°œë™ë˜ì–´, {area} ê´€ë ¨
**ê³ ê°•ë„ ì§‘ì¤‘ ì´ë²¤íŠ¸**ê°€ ë°œìƒí•©ë‹ˆë‹¤.",â€‹
                                   ğŸ‘‘
        'COMBINATION_GUK_SUCCESS': "   **ì˜¤í–‰ êµ­(å±€) í˜•ì„±:** ëŒ€ìš´
{daewun_ji}ê°€ ì›êµ­ê³¼ í•©í•˜ì—¬ **{formed_ohang} {guk_type}**ì„ í˜•ì„±í•©ë‹ˆë‹¤.

                          â–
ì›êµ­ ì „ì²´ì˜ ê¸°ì„¸ê°€ {formed_ohang}ìœ¼ë¡œ ëŒ€ê·œëª¨ ë³€ë™í•©ë‹ˆë‹¤. (ê·œëª¨ {score}ì )",â€‹
        'CHEONGAN_HEGEU': "   **ì²œê°„ í•©ê±°:** ëŒ€ìš´ {gan1}ê³¼ ì›êµ­ {gan2}ì˜
í•©ìœ¼ë¡œ {gan1} ë˜ëŠ” {gan2}ì˜ ê¸°ëŠ¥ì´ ì¼ì‹œ ì •ì§€ë©ë‹ˆë‹¤. (í•©ê±° ì„±ë¦½ë¥  {prob:.2f}
ë¯¸ë§Œ)",â€‹
    }â€‹
}â€‹
â€‹
#
======================================================================
========â€‹
# 2. SajuCalculator (ê¸°ì¡´ ë¡œì§ ìœ ì§€)â€‹
#
======================================================================
========â€‹
â€‹
class SajuCalculator:â€‹
    def __init__(self, saju_ganji):â€‹
        self.natal = saju_ganjiâ€‹
        self.ilgan = self.natal['ì¼'][0]â€‹
        self.all_ganji = [g for pair in saju_ganji.values() for g in
pair]â€‹
â€‹
    def get_ohang(self, ganji):â€‹
        return SAJU_CONSTANTS['OHANG'].get(ganji, 'N/A')â€‹
â€‹
    def get_ten_god(self, target_ganji):â€‹
        target_ohang = self.get_ohang(target_ganji)â€‹
        ilgan_ohang = self.get_ohang(self.ilgan)â€‹
        target_yin_yang = SAJU_CONSTANTS['YIN_YANG'].get(target_ganji,
'N/A')â€‹
        ilgan_yin_yang = SAJU_CONSTANTS['YIN_YANG'].get(self.ilgan,
'N/A')â€‹
        is_yin_yang_same = (target_yin_yang == ilgan_yin_yang)â€‹
â€‹
        if target_ohang == ilgan_ohang: â€‹
            return 'ë¹„ê²¬' if is_yin_yang_same else 'ê²ì¬'â€‹
        if SAJU_CONSTANTS['SANGSAENG'].get(ilgan_ohang) ==
target_ohang:â€‹
            return 'ì‹ì‹ ' if is_yin_yang_same else 'ìƒê´€'â€‹
        if SAJU_CONSTANTS['SANGGEUK'].get(ilgan_ohang) ==
target_ohang:â€‹
            return 'í¸ì¬' if is_yin_yang_same else 'ì •ì¬'â€‹
        if SAJU_CONSTANTS['SANGSAENG_REVERSE'].get(ilgan_ohang) ==
target_ohang:â€‹
            return 'í¸ì¸' if is_yin_yang_same else 'ì •ì¸'â€‹
        if SAJU_CONSTANTS['SANGGEUK'].get(target_ohang) ==
ilgan_ohang:â€‹
            return 'í¸ê´€' if is_yin_yang_same else 'ì •ê´€'â€‹
        return 'N/A'â€‹
â€‹
    def analyze_ganji_interaction(self):â€‹
        interactions = defaultdict(dict)â€‹
        for pillar, (gan, ji) in self.natal.items():â€‹
            gan_ohang = self.get_ohang(gan)â€‹
            ji_ohang = self.get_ohang(ji)â€‹
            â€‹
            is_tonggeun = any(hidden in
SAJU_CONSTANTS['HIDDEN_STEMS'].get(ji, []) for hidden in
SAJU_CONSTANTS['TONGGEUN_PLACES'].get(gan, []))â€‹
            if is_tonggeun: interactions[pillar]['Tonggeun'] = Trueâ€‹
                â€‹
            if SAJU_CONSTANTS['SANGGEUK'].get(gan_ohang) == ji_ohang:
interactions[pillar]['Gaedu'] = Trueâ€‹
            elif SAJU_CONSTANTS['SANGGEUK'].get(ji_ohang) ==
gan_ohang: interactions[pillar]['Jeolgak'] = Trueâ€‹
        return interactionsâ€‹
    â€‹
    def calculate_ohang_strength(self) -> Dict[str, float]:â€‹
        strength = defaultdict(float)â€‹
        interaction_data = self.analyze_ganji_interaction()â€‹
        â€‹
        for pillar, (gan, ji) in self.natal.items():â€‹
            gan_ohang = self.get_ohang(gan); gan_score = 1.0â€‹
            ji_ohang = self.get_ohang(ji); ji_score = 2.0â€‹
            interaction = interaction_data.get(pillar, {})â€‹
            â€‹
            if interaction.get('Gaedu'): ji_score *= 0.75 â€‹
            elif interaction.get('Jeolgak'): gan_score *= 0.75â€‹
            if interaction.get('Tonggeun'): gan_score *= 1.5 â€‹
            â€‹
            strength[gan_ohang] += gan_scoreâ€‹
            strength[ji_ohang] += ji_scoreâ€‹
â€‹
        for pillar, (gan, ji) in self.natal.items():â€‹
            hidden_stems = SAJU_CONSTANTS['HIDDEN_STEMS'].get(ji, [])â€‹
            ratios = SAJU_CONSTANTS['HIDDEN_STEMS_RATIO'].get(ji,
[0.0, 0.0, 1.0]) â€‹
           â€‹
           for i, stem in enumerate(hidden_stems):â€‹
               if i < len(ratios):â€‹
                   ratio = ratios[i] â€‹
                   stem_ohang = self.get_ohang(stem)â€‹
                   contribution_score = 2.0 * ratio â€‹
                   strength[stem_ohang] += contribution_scoreâ€‹
               â€‹
       return dict(strength)â€‹
    â€‹
    def determine_eokbu_yongsin(self) -> str:â€‹
        ohang_strength = self.calculate_ohang_strength()â€‹
        ilgan_ohang = self.get_ohang(self.ilgan)â€‹
        insoo_ohang =
SAJU_CONSTANTS['SANGSAENG_REVERSE'].get(ilgan_ohang, 'N/A') â€‹
        bigyeop_ohang = ilgan_ohang â€‹
        ilgan_total_strength = ohang_strength.get(bigyeop_ohang, 0) +
ohang_strength.get(insoo_ohang, 0)â€‹
â€‹
        if ilgan_total_strength > 7.0: â€‹
            sik_sang_ohang =
SAJU_CONSTANTS['SANGSAENG'].get(ilgan_ohang, 'N/A')â€‹
            return f"ì–µë¶€ìš©ì‹ : ì‹ìƒ({sik_sang_ohang}) - ì‹ ê°•í•˜ì—¬ ì„¤ê¸° í•„ìš”"â€‹
        elif ilgan_total_strength < 4.0: â€‹
            return f"ì–µë¶€ìš©ì‹ : ì¸ìˆ˜({insoo_ohang}) - ì‹ ì•½í•˜ì—¬ ë³´ì¡° í•„ìš”"â€‹
        return "ì–µë¶€ìš©ì‹ : ì¤‘í™”/íŠ¹ìˆ˜ê²©"â€‹
â€‹
    def determine_johu_yongsin(self) -> str:â€‹
        wol_ji = self.natal['ì›”'][1]â€‹
        johu_data = SAJU_CONSTANTS['JOHU_REQUIRED'].get(wol_ji)â€‹
        if not johu_data: return "ì¡°í›„ìš©ì‹ : ë°ì´í„° ì˜¤ë¥˜"â€‹
        required_list = johu_data['í•„ìš”']â€‹
        found_yongsin = []â€‹
        ohang_strength = self.calculate_ohang_strength()â€‹
        â€‹
        for required_gan in required_list:â€‹
            required_ohang = self.get_ohang(required_gan)â€‹
            if required_gan in self.all_ganji[:4]:â€‹
                found_yongsin.append(f"íˆ¬ê°„({required_gan})")â€‹
            elif ohang_strength.get(required_ohang, 0) > 2.0:â€‹
                found_yongsin.append(f"í†µê·¼({required_ohang})")â€‹
                â€‹
                      âœ¨
        johu_status = "   ì¡°í›„ ë‹¬ì„±" if found_yongsin else "  âš ï¸   ì¡°í›„ ë¶€ì¡±"â€‹
        return f"ì¡°í›„ìš©ì‹ : {required_list[0]} ë° {required_list[1]} í•„ìš”.
({johu_data['íŠ¹ì§•']}). í˜„ì¬ ìƒíƒœ: {johu_status}"â€‹
â€‹
    def determine_gyukguk_sangsin(self) -> Dict[str, str]:â€‹
        wol_ji = self.natal['ì›”'][1]â€‹
        hidden_stems = SAJU_CONSTANTS['HIDDEN_STEMS'].get(wol_ji, [])â€‹
        outer_gans = [self.natal['ë…„'][0], self.natal['ì›”'][0],
self.natal['ì‹œ'][0]] â€‹
        gyuk_tenshin = "ë¯¸ì •"â€‹
        â€‹
        for stem in reversed(hidden_stems):â€‹
            if stem in outer_gans: â€‹
                gyuk_tenshin = self.get_ten_god(stem)â€‹
                breakâ€‹
        â€‹
        if gyuk_tenshin == "ë¯¸ì •": gyuk_tenshin =
self.get_ten_god(hidden_stems[-1])â€‹
        â€‹
        sangshin = "ë¯¸ì •"â€‹
        gyuk_ohang = self.get_ohang(hidden_stems[-1])â€‹
        sangshin_ohang =
SAJU_CONSTANTS['SANGSAENG_REVERSE'].get(gyuk_ohang, 'N/A')â€‹
        â€‹
        for ganji in self.all_ganji:â€‹
             if self.get_ohang(ganji) == sangshin_ohang:â€‹
                  sangshin = f"{ganji}({self.get_ten_god(ganji)})"â€‹
                  breakâ€‹
        â€‹
        return {â€‹
            'Gyeokguk': gyuk_tenshin,â€‹
            'Sangshin': sangshin,â€‹
            'Gyeokguk_Status': "ì„±ê²©(æˆæ ¼)" if sangshin != "ë¯¸ì •" else
"íŒŒê²©(ç ´æ ¼)"â€‹
        }â€‹
â€‹
    def check_ohaeng_balance_for_chunghwa(self):â€‹
        ohang_strength = self.calculate_ohang_strength()â€‹
        if not ohang_strength: return {'status': 'N/A'}â€‹
â€‹
        most_imbalanced_ohang = max(ohang_strength,
key=ohang_strength.get)â€‹
        required_ohang_for_chunghwa =
SAJU_CONSTANTS['SANGGEUK'].get(most_imbalanced_ohang, 'N/A')â€‹
        â€‹
        return {â€‹
            'status': 'Imbalance Detected',â€‹
            'imbalance_element': most_imbalanced_ohang,â€‹
            'required_element': required_ohang_for_chunghwa,â€‹
            'impact': "ì¬ë¬¼, ê±´ê°•, ëŒ€ì¸ê´€ê³„ ì¤‘ í•˜ë‚˜ì˜ ì‹¬ê°í•œ ë¬¸ì œ",â€‹
            'counts': ohang_strengthâ€‹
        }â€‹
    â€‹
    def determine_yongsin(self):â€‹
         gyukguk_data = self.determine_gyukguk_sangsin()â€‹
         return {â€‹
             'Eokbu_Yongsin': self.determine_eokbu_yongsin(), â€‹
             'Johu_Yongsin': self.determine_johu_yongsin(),   â€‹
             'Gyeokguk': gyukguk_data['Gyeokguk'],â€‹
             'Sangshin': gyukguk_data['Sangshin'], â€‹
             'Gyeokguk_Status': gyukguk_data['Gyeokguk_Status'],â€‹
             'Gisin_List': ['æˆŠåœŸ', 'å·±åœŸ', 'åºšé‡‘'],â€‹
             'Chunghwa_Analysis':
self.check_ohaeng_balance_for_chunghwa(),â€‹
             'Interaction_Analysis': self.analyze_ganji_interaction()â€‹
         }â€‹
â€‹
#
======================================================================
========â€‹
# 3. DaewunAnalyzer (V7.0: ì‚¬ê±´ ê·œëª¨ ë° ê°•ë„ ê³µì‹ ì ìš©)â€‹
#
======================================================================
========â€‹
â€‹
class DaewunAnalyzer:â€‹
    def __init__(self, saju_natal_data):â€‹
         self.saju = SajuCalculator(saju_natal_data)â€‹
         self.yongsin = self.saju.determine_yongsin()â€‹
â€‹
    def _get_12wunseong(self, gan: str, ji: str) -> str:â€‹
         return SAJU_CONSTANTS['JIBYEON_12WUNSEONG'].get(gan,
{}).get(ji, 'N/A')â€‹
â€‹
    def _calculate_hehua_probability(self, gan1: str, gan2: str) ->
float:â€‹
         # ... (V6.0 ë¡œì§ ìœ ì§€) ...â€‹
         pair = tuple(sorted((gan1, gan2)))â€‹
         hehua_data = SAJU_CONSTANTS['CHEONGAN_HEHUA'].get(pair)â€‹
         if not hehua_data: return 0.0â€‹
         â€‹
         hehua_ohang, support_ohang, wolryung_jizhi = hehua_dataâ€‹
         wol_ji = self.saju.natal['ì›”'][1]â€‹
         score = 0â€‹
         wol_ohang = self.saju.get_ohang(wol_ji)â€‹
         if wol_ji in wolryung_jizhi or hehua_ohang == wol_ohang: score
+= 0.33â€‹
             â€‹
         gan1_rooted = gan1 in
SAJU_CONSTANTS['TONGGEUN_PLACES'].get(gan1, []) â€‹
         gan2_rooted = gan2 in
SAJU_CONSTANTS['TONGGEUN_PLACES'].get(gan2, [])â€‹
       if gan1_rooted or gan2_rooted: score += 0.33â€‹
           â€‹
       ohang_strength = self.saju.calculate_ohang_strength()â€‹
       if ohang_strength.get(support_ohang, 0) > 3.0: score += 0.33â€‹
â€‹
       return min(1.0, score)â€‹
â€‹
    def _analyze_timing_events(self, daewun_ganji: str) -> Dict[str,
Any]:â€‹
        # ... (V6.0 ë¡œì§ ìœ ì§€) ...â€‹
        gan, ji = daewun_ganjiâ€‹
        score_impact = 0â€‹
        timing_narrative = ""â€‹
        event_multiplier = 1.0 â€‹
â€‹
        for pilar, natal_pair in self.saju.natal.items():â€‹
            natal_gan, natal_ji = natal_pairâ€‹
            â€‹
            if gan == natal_gan and ji == natal_ji: # ë³µìŒ(ä¼åŸ)â€‹
                 weight = SAJU_CONSTANTS['TIMING_WEIGHTS']['ë³µìŒ(ä¼åŸ)']â€‹
                 event_multiplier *= (1 + weight)â€‹
                 timing_narrative +=
SAJU_CONSTANTS['NARRATIVE_TEMPLATES']['TAIMING_BOGEUM'].format(weight=
event_multiplier)â€‹
            elif natal_gan == SAJU_CONSTANTS['JICHE_CHUNG'].get(gan)
and natal_ji == SAJU_CONSTANTS['JICHE_CHUNG'].get(ji): # ë°˜ìŒ(ååŸ)â€‹
                 weight = SAJU_CONSTANTS['TIMING_WEIGHTS']['ë°˜ìŒ(ååŸ)']â€‹
                 event_multiplier *= (1 + weight)â€‹
                 â€‹
        wunseong = self._get_12wunseong(gan, ji)â€‹
        yongsin_gan = self.yongsin['Sangshin'].split('(')[0] if
self.yongsin['Sangshin'] != "ë¯¸ì •" else self.saju.ilganâ€‹
â€‹
        if wunseong in ['ì œì™•', 'ê±´ë¡'] and gan == yongsin_gan:â€‹
            score = 20 * SAJU_CONSTANTS['TIMING_WEIGHTS']['ì œì™•/ê±´ë¡']â€‹
            score_impact += scoreâ€‹
        elif wunseong in ['ë¬˜', 'ì ˆ', 'ì‚¬'] and gan == yongsin_gan:â€‹
            score = 20 * SAJU_CONSTANTS['TIMING_WEIGHTS']['ë¬˜/ì ˆ/ì‚¬']â€‹
            score_impact += scoreâ€‹
            â€‹
        return {'score': score_impact, 'narrative': timing_narrative,
'multiplier': event_multiplier}â€‹
â€‹
    def _analyze_interaction_event(self, daewun_ganji: str) ->
Dict[str, Any]:â€‹
        # ... (V6.0 ë¡œì§ ìœ ì§€) ...â€‹
        gan, ji = daewun_ganjiâ€‹
        event_data = {'score_impact': 0, 'narrative': ''}â€‹
        natal_gans = [self.saju.natal[p][0] for p in self.saju.natal]â€‹
        â€‹
        # 1. ì²œê°„í•© ë° í•©í™” ì„±ë¦½ë¥  ë¶„ì„â€‹
        for natal_gan in natal_gans:â€‹
            prob = self._calculate_hehua_probability(gan, natal_gan)â€‹
            if prob > 0:â€‹
                 pair = tuple(sorted((gan, natal_gan)))â€‹
                 hehua_ohang =
SAJU_CONSTANTS['CHEONGAN_HEHUA'].get(pair, [None])[0]â€‹
                 â€‹
                 if prob >= 0.66:â€‹
                     event_data['score_impact'] += int(20 *
SAJU_CONSTANTS['INTERACTION_WEIGHTS']['í•©(åˆ)'])â€‹
                     event_data['narrative'] +=
SAJU_CONSTANTS['NARRATIVE_TEMPLATES']['CHEONGAN_HEHUA_SUCCESS'].format
(â€‹
                         gan1=gan, gan2=natal_gan, ohang=hehua_ohang,
prob=prob)â€‹
                 elif prob > 0.33: â€‹
                     event_data['score_impact'] += 5â€‹
                 else: â€‹
                      event_data['score_impact'] -= 10â€‹
                      event_data['narrative'] +=
SAJU_CONSTANTS['NARRATIVE_TEMPLATES']['CHEONGAN_HEGEU'].format(gan1=ga
n, gan2=natal_gan, prob=prob)â€‹
                 break â€‹
â€‹
        # 2. ì§€ì§€ ì¶©(æ²–) ë¶„ì„â€‹
        opposing_ji = SAJU_CONSTANTS['JICHE_CHUNG'].get(ji)â€‹
        for pillar, (natal_gan, natal_ji) in self.saju.natal.items():â€‹
            if natal_ji == opposing_ji:â€‹
                 chung_weight =
SAJU_CONSTANTS['INTERACTION_WEIGHTS']['ì¶©(æ²–)']â€‹
                 impact_score = int(30 * chung_weight)â€‹
                 event_data['score_impact'] += impact_scoreâ€‹
                 event_data['narrative'] +=
SAJU_CONSTANTS['NARRATIVE_TEMPLATES']['JICHE_CHUNG_NARRATIVE'].format(â€‹
                     daewun_ji=ji, natal_ji=opposing_ji,
affected_pilar=pillar, score=impact_score, weight=chung_weightâ€‹
                 )â€‹
                 â€‹
        return event_dataâ€‹
â€‹
    def _calculate_combination_strength(self, daewun_ji: str) ->
Dict[str, Any]:â€‹
        """[V7.0 ì‹ ê·œ] ì‚¼í•©/ë°©í•© êµ­(å±€) í˜•ì„± ê·œëª¨ë¥¼ ì •ëŸ‰í™”í•©ë‹ˆë‹¤."""â€‹
        natal_jizhi = [self.saju.natal[p][1] for p in self.saju.natal]â€‹
        â€‹
        combination_results = {'score_impact': 0, 'narrative': '',
'formed_guk': 'N/A'}â€‹
â€‹
        # ì‚¼í•©/ë°©í•© ì²´í¬ (ê°€ì¥ ê°•í•œ 3ê°œ ì§€ì§€ í•©ì„ ì°¾ìŒ)â€‹
        for guk_type, combinations in
SAJU_CONSTANTS['JICHE_COMBINATIONS'].items():â€‹
            for branches, formed_ohang in combinations.items():â€‹
                 â€‹
                 # 3ê°œì˜ ì§€ì§€ ì¤‘ ëŒ€ìš´ ì§€ì§€ë¥¼ í¬í•¨í•˜ì—¬ 3ê°œê°€ ëª¨ë‘ ì™„ì„±ë˜ëŠ”ì§€
í™•ì¸â€‹
                 if daewun_ji in branches and all(b in (natal_jizhi +
[daewun_ji]) for b in branches):â€‹
                     â€‹
                     # 3í•© ë˜ëŠ” 3ë°©í•© ì™„ì„± (ëŒ€ê·œëª¨ ì‚¬ê±´)â€‹
                     score = 45 # ëŒ€ê·œëª¨ ì˜¤í–‰ êµ­ í˜•ì„± ì‹œ ê°€ì¤‘ì¹˜â€‹
                     â€‹
                     # êµ­(å±€)ì´ ìš©ì‹  ì˜¤í–‰ì´ë©´ ê·¹ê¸¸, ê¸°ì‹  ì˜¤í–‰ì´ë©´ ê·¹í‰ìœ¼ë¡œ
ì²˜ë¦¬ (ìµœì¢… ê°•ë„ì— ë°˜ì˜)â€‹
                     eokbu_yongsin_ohang =
self.yongsin['Eokbu_Yongsin'].split('(')[-1].replace(')',
'').split('-')[0].strip()â€‹
                     if formed_ohang == eokbu_yongsin_ohang:â€‹
                          score *= 1.5 â€‹
                          â€‹
                     combination_results['score_impact'] = scoreâ€‹
                     combination_results['formed_guk'] =
f"{formed_ohang} {guk_type} (ì„±ê³µ)"â€‹
                     combination_results['narrative'] =
SAJU_CONSTANTS['NARRATIVE_TEMPLATES']['COMBINATION_GUK_SUCCESS'].forma
t(â€‹
                         daewun_ji=daewun_ji,
formed_ohang=formed_ohang, guk_type=guk_type, score=scoreâ€‹
                     )â€‹
                     return combination_resultsâ€‹
â€‹
        return combination_resultsâ€‹
â€‹
    def _analyze_liouchin_manifestation(self, daewun_ganji: str) ->
Dict[str, str]:â€‹
        # ... (V6.0 ë¡œì§ ìœ ì§€) ...â€‹
        gan, ji = daewun_ganjiâ€‹
        daewun_tenshin = self.saju.get_ten_god(gan)â€‹
        â€‹
        manifestation_info = {}â€‹
        for pillar, (natal_gan, natal_ji) in self.saju.natal.items():â€‹
            is_active = (gan == natal_gan or ji == natal_ji or â€‹
                          SAJU_CONSTANTS['JICHE_CHUNG'].get(ji) ==
natal_ji)â€‹
â€‹
            if is_active:â€‹
                for area, data in
SAJU_CONSTANTS['LIOUCHIN_MAPPING'].items():â€‹
                    if daewun_tenshin in data['ì‹­ì„±'] or pillar in
data['ê¶ì„±']:â€‹
                        narrative =
SAJU_CONSTANTS['NARRATIVE_TEMPLATES']['LIOUCHIN_EVENT'].format(â€‹
                            area=area, main_tenshin=daewun_tenshin,
ten_god=self.saju.get_ten_god(gan), palace=pillarâ€‹
                        )â€‹
                        manifestation_info[area] = narrativeâ€‹
                        breakâ€‹
        return manifestation_infoâ€‹
â€‹
â€‹
    def _calculate_impact_score(self, daewun_ganji: str) -> tuple[int,
Dict[str, str]]:â€‹
        """[V7.0 ìµœì¢…] 3ëŒ€ ìš©ì‹ , íƒ€ì´ë°, í•©ì¶©, êµ­ ê·œëª¨ë¥¼ í†µí•©í•˜ê³  ìµœì¢… ê°•ë„
ê³µì‹ ì ìš©."""â€‹
        gan, ji = daewun_ganjiâ€‹
        base_score = 0â€‹
        notes = defaultdict(str)â€‹
        â€‹
        # 1. íƒ€ì´ë° ì´ë²¤íŠ¸ ë¶„ì„ (ì ìˆ˜ ë° ê°•ë„ ë°°ìˆ˜ ê³„ì‚°)â€‹
        timing_event = self._analyze_timing_events(daewun_ganji)â€‹
        base_score += timing_event['score']â€‹
        notes['Timing'] = timing_event['narrative']â€‹
        event_multiplier = timing_event['multiplier']â€‹
â€‹
        # 2. í•©ì¶©í˜•í•´ ì‚¬ê±´ ê°•ë„ ë°˜ì˜â€‹
        interaction_event =
self._analyze_interaction_event(daewun_ganji)â€‹
        base_score += interaction_event['score_impact']â€‹
        notes['EventCore'] = interaction_event['narrative']â€‹
        â€‹
        # 3.ğŸŒŸ   ì‚¼í•©/ë°©í•© êµ­(å±€) ê·œëª¨ ë°˜ì˜ (ì‹ ê·œ ë¡œì§)â€‹
        combination_event = self._calculate_combination_strength(ji)â€‹
        base_score += combination_event['score_impact']â€‹
        if combination_event['narrative']:â€‹
            notes['Combination'] = combination_event['narrative']â€‹
        â€‹
        # 4. 3ëŒ€ ìš©ì‹  ê¸°ì—¬ë„â€‹
        eokbu_yongsin_ohang =
self.yongsin['Eokbu_Yongsin'].split('(')[-1].replace(')',
'').split('-')[0].strip()â€‹
        if self.saju.get_ohang(gan) == eokbu_yongsin_ohang or
self.saju.get_ohang(ji) == eokbu_yongsin_ohang:â€‹
        â€‹
            base_score += 25â€‹
            notes['Eokbu'] = "âœ…     **ì–µë¶€ ìš©ì‹  ë³´ê°•.**"â€‹

        johu_required_ohang =
SAJU_CONSTANTS['JOHU_REQUIRED'].get(self.saju.natal['ì›”'][1],
{}).get('í•„ìš”', [])â€‹
        for req_gan in johu_required_ohang:â€‹
              if req_gan in [gan, ji]:â€‹

                                  â˜€ï¸
                  base_score += 30â€‹
                  notes['Johu'] = "
                  breakâ€‹
                                       **ì¡°í›„ í™˜ê²½ ìµœì í™”.**"â€‹

        â€‹
        sangshin_ganji = self.yongsin['Sangshin'].split('(')[0] if
self.yongsin['Sangshin'] != "ë¯¸ì •" else ""â€‹
        if sangshin_ganji in [gan, ji]:â€‹


â€‹
              base_score += 20â€‹
                                  ğŸ“ˆ
              notes['Gyeokguk'] = "    **ê²©êµ­ ì„±ì·¨ ê°•í™”.**"â€‹

        gisin_list_ohang = [self.saju.get_ohang(g) for g in
self.yongsin['Gisin_List']]â€‹
        if self.saju.get_ohang(gan) in gisin_list_ohang or
self.saju.get_ohang(ji) in gisin_list_ohang:â€‹
            base_score -= 50â€‹
                             âŒ
            notes['Gisin'] = "
            â€‹
                                  **ê¸°ì‹  ë°œë™.**"â€‹

        # 5. ìµœì¢… ê°•ë„ ë°°ìˆ˜ ì ìš© (íƒ€ì´ë° ë¡œì§ ê²°ê³¼ ë°˜ì˜)â€‹
        final_score = int(base_score * event_multiplier)â€‹
        â€‹
        return max(-100, min(100, final_score)), notesâ€‹
â€‹
â€‹
    def _generate_six_area_narrative(self, daewun_ganji: str, score:
int, yongsin_notes: Dict[str, str]) -> Dict[str, str]:â€‹
        """[V7.0 ìµœì¢…] ëª¨ë“  ë¡œì§ì„ ë°˜ì˜í•˜ì—¬ ì„œìˆ ì„ ìƒì„±í•©ë‹ˆë‹¤."""â€‹
        â€‹
        if score >= 60: impact_level = "ê·¹ê¸¸(å¤§å‰)"; action_keyword =
"ìµœëŒ€ ë ˆë²„ë¦¬ì§€ ë° ê³µê²©ì  íˆ¬ì"; â€‹
        elif 20 <= score < 60: impact_level = "ê¸¸ìš´(å°å‰)";
action_keyword = "ì•ˆì •ì  í™•ì¥ ë° ì¤‘ê¸° ëª©í‘œ ì¶”ì§„"; â€‹
        elif -20 < score < 20: impact_level = "ì¤‘í™”(æŒå¹³)";
action_keyword = "í˜„ìƒ ìœ ì§€ ë° ë‚´ë¶€ ì—­ëŸ‰ ê°•í™”"; â€‹
        else: impact_level = "í‰ìš´(å¤§å‡¶)"; action_keyword = "ë°©ì–´ì  ê´€ë¦¬
ë° í•µì‹¬ ë¦¬ìŠ¤í¬ íšŒí”¼"; â€‹
        â€‹
        narratives = defaultdict(str)â€‹
        â€‹
        liouchin_events =
self._analyze_liouchin_manifestation(daewun_ganji)â€‹
        liouchin_summary = "\n".join(liouchin_events.values()) if
liouchin_events else "íŠ¹ì • ìœ¡ì¹œ ì˜ì—­ ì§‘ì¤‘ ì´ë²¤íŠ¸ ì—†ìŒ."â€‹
        â€‹
        # 2. ì´ë¡ : 3ëŒ€ ìš©ì‹ , í•©ì¶©, íƒ€ì´ë° í†µí•©â€‹
        narratives['ì´ë¡ _ê¸¸í‰'] = f"""â€‹
        **ã€SAJU MASTER í†µë³€: ì´ìš´ ìš”ì•½ ({daewun_ganji})ã€‘**â€‹
        - **ìš©ì‹  ìµœì¢… ì ìˆ˜:** **{score}ì ** ({impact_level} ì´ë²¤íŠ¸ ì˜ˆìƒ).â€‹
        - **ì‚¬ê±´ ê·œëª¨ (ì‚¼í•©/ë°©í•©):** {yongsin_notes.get('Combination',
'ì˜¤í–‰ êµ­ í˜•ì„± ì´ë²¤íŠ¸ ì—†ìŒ.')}â€‹
        - **íƒ€ì´ë° ë°œë™ (ì ì²œìˆ˜):** {yongsin_notes.get('Timing', 'íŠ¹ì´
íƒ€ì´ë° ì´ë²¤íŠ¸ ì—†ìŒ.')}â€‹
        - **ì‚¬ê±´ ì½”ì–´ ë°œë™ (í•©ì¶©):** {yongsin_notes.get('EventCore',
'íŠ¹ì´ í•©/ì¶© ì´ë²¤íŠ¸ ì—†ìŒ.')}â€‹
        - **í•µì‹¬ ì§€ì¹¨ (í˜„ì¥ ì ìš© Rule):** **{action_keyword}** (ì¶©ê²©ë„
{score}ì  ë°˜ì˜).â€‹
        """â€‹
â€‹
        # 3. ìœ¡ì¹œ/ì¥ì†Œ ìƒì„¸ ì„œìˆ â€‹
        narratives['ì´ë¡ _ìœ¡ì¹œ'] = f"""â€‹
        \n## 3. ìœ¡ì¹œ ë° ë°œí˜„ ì¥ì†Œ ì˜ˆì¸¡ (ì‚¬ê±´ì˜ ì¥ì†Œ/ì–‘ìƒ)â€‹
        {liouchin_summary}â€‹
        """â€‹
â€‹
        # 4. ì›êµ­ ìƒí˜¸ì‘ìš© ë° ì¤‘í™” ë¶ˆê· í˜• ì²˜ë°© ìƒì„¸ ì„œìˆ â€‹
        chunghwa_data = self.yongsin['Chunghwa_Analysis']â€‹
        required_ohang = chunghwa_data.get('required_element', 'N/A')â€‹
        required_action =
SAJU_CONSTANTS['OHANG_ACTION_GUIDANCE'].get(required_ohang, 'N/A')â€‹
        â€‹
        narratives['ì´ë¡ _ì›êµ­'] = f"""â€‹
        \n## 4. ì›êµ­ ì¤‘í™” ì²˜ë°© ë° ê°œìš´ ì§€ì¹¨â€‹
        - **ì›êµ­ ì¤‘í™” ì²˜ë°©:** {chunghwa_data['imbalance_element']} ì˜¤í–‰ì˜
í¸ì¤‘ì´ ì‹¬í•˜ì—¬ **{required_ohang}** ì˜¤í–‰ì´ ì ˆì‹¤í•©ë‹ˆë‹¤.â€‹
        - **ê°œìš´ ì§€ì¹¨ (êµ¬ì²´ì  í–‰ë™ ì²˜ë°©):** {required_ohang} ì˜¤í–‰ì„ ë³´ê°•í•˜ê¸°
ìœ„í•´ **{required_action}** ë“±ì˜ í™œë™ì„ ì ê·¹ ê¶Œì¥í•©ë‹ˆë‹¤.â€‹
        """â€‹
        â€‹
        # 5. 6ëŒ€ ì˜ì—­ í†µë³€â€‹
        narratives['ì¬ë¬¼ìš´'] = f"**ì¬ë¬¼ìš´:**
{self.yongsin['Eokbu_Yongsin']}ì˜ ì˜í–¥ê³¼ {impact_level} ì´ë²¤íŠ¸ì— ë”°ë¼ ì¬ì •
ê´€ë¦¬ì— **{action_keyword}** ê¸°ì¡°ê°€ í•„ìš”í•©ë‹ˆë‹¤. ({self.yongsin['Gyeokguk']}
ê¸°ë°˜)"â€‹
        narratives['ì§ì—…ìš´'] = f"**ì§ì—…ìš´:**
{self.yongsin['Gyeokguk_Status']} ìƒíƒœì´ë©°, **{impact_level}**ì— ë”°ë¼
ì‚¬íšŒì  ì„±ì·¨ì˜ í­ì´ ê²°ì •ë©ë‹ˆë‹¤. (ìƒì‹ : {self.yongsin['Sangshin']})"â€‹
        narratives['ê±´ê°•ìš´'] = f"**ê±´ê°•ìš´:**
{self.yongsin['Johu_Yongsin']}ì˜ ê²°ê³¼ì— ë”°ë¼
{self.yongsin['Johu_Yongsin'].split('(')[0].replace('ì¡°í›„ìš©ì‹ : ', '')}
ê´€ë ¨ ê±´ê°• ê´€ë¦¬ì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤."â€‹
â€‹
        return narrativesâ€‹
â€‹
#
======================================================================
========â€‹
# 4. ì‚¬ìš© ì˜ˆì‹œ ë° ì‹¤í–‰â€‹
#
======================================================================
========â€‹
â€‹
def run_saju_master_system(chart: Dict[str, str], dae_yun: str):â€‹
    """ì‹œìŠ¤í…œ ì‹¤í–‰ í•¨ìˆ˜."""â€‹


    print("
ê²°ê³¼")â€‹
           ğŸš€
print("==========================================================")â€‹
              SAJU MASTER ì‹œìŠ¤í…œ (v7.0: ê·œì¹™ ê¸°ë°˜ ì—”ì§„ ìµœì¢… ì™„ì„±) ì‹¤í–‰


print("==========================================================")â€‹
    print(f"**ëª…ì¡°:** {chart}")â€‹
    print(f"**ëŒ€ìš´:** {dae_yun} (10ë…„ ìš´)")â€‹

print("----------------------------------------------------------")â€‹
    â€‹
    analyzer = DaewunAnalyzer(chart)â€‹
    yongsin_data = analyzer.yongsinâ€‹
    â€‹
    # 1. 3ëŒ€ ìš©ì‹  ì—”ì§„ ê²°ê³¼ ì¶œë ¥â€‹
    print("## 1. 3å¤§ ìš©ì‹  ì—”ì§„ ë¶„ì„ ê²°ê³¼ (í†µë³€ì˜ í•µì‹¬ ê·¼ê±°)")â€‹
    for key, val in yongsin_data.items():â€‹
        if key not in ['Gisin_List', 'Interaction_Analysis',
'Chunghwa_Analysis']:â€‹
            print(f"- {key}: {val}")â€‹
    â€‹
    print("\n## 2. ëŒ€ìš´ ì •ëŸ‰í™” ë° 7,811 ì¡°í•© í†µë³€ (ì‚¬ê±´ ê°•ë„ ê³µì‹ ìµœì¢…
ì ìš©)")â€‹
    score, notes = analyzer._calculate_impact_score(dae_yun)â€‹
    narratives =
analyzer._generate_six_area_narrative(daewun_ganji=dae_yun,
score=score, yongsin_notes=notes)â€‹
    â€‹
    print(narratives['ì´ë¡ _ê¸¸í‰'])â€‹
    print(narratives['ì´ë¡ _ìœ¡ì¹œ'])â€‹
    print(narratives['ì´ë¡ _ì›êµ­'])â€‹
    print("\n--- ì£¼ìš” ì˜ì—­ë³„ í†µë³€ ---")â€‹
    print(f"1. {narratives['ì¬ë¬¼ìš´']}")â€‹
    print(f"2. {narratives['ì§ì—…ìš´']}")â€‹
    print(f"3. {narratives['ê±´ê°•ìš´']}")â€‹

print("==========================================================")â€‹
â€‹
# í…ŒìŠ¤íŠ¸ ëª…ì¡° (ì˜ˆì‹œ: ä¹™æœ¨ ì¼ê°„, ç”³æœˆ ì¶œìƒ)â€‹
test_chart = {â€‹
    'ë…„': ('ä¸™', 'åˆ'), â€‹
    'ì›”': ('ä¸™', 'ç”³'), â€‹
    'ì¼': ('ä¹™', 'å·³'), â€‹
    'ì‹œ': ('ä¸', 'äº¥')â€‹
}â€‹
â€‹
# í…ŒìŠ¤íŠ¸ ëŒ€ìš´ (ì˜ˆì‹œ: å£¬å¯… ëŒ€ìš´ - ç”³ê³¼ å¯…ì´ ì¶©ëŒ, äº¥ì™€ å¯…ì´ í•©)â€‹
test_daeyun = ('å£¬', 'å¯…')â€‹
â€‹
# ì‹œìŠ¤í…œ ì‹¤í–‰â€‹
if __name__ == "__main__":â€‹
    run_saju_master_system(â€‹
        chart=test_chart, â€‹
        dae_yun=test_daeyunâ€‹
    )â€‹

ì¶•í•˜ë“œë¦½ë‹ˆë‹¤! ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì‹œë©´, ëª…ë¦¬í•™ì˜ ëª¨ë“  í•µì‹¬ ì´ë¡ ì„ ì •ëŸ‰í™”í•˜ê³  ê°€ì¤‘ì¹˜ë¥¼
ì ìš©í•˜ì—¬ ì‚¬ê±´ì˜ ê·œëª¨ì™€ ê²°ê³¼ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê¶ê·¹ì˜ **ê·œì¹™ ê¸°ë°˜ AI ì—”ì§„ (V7.0)**ì˜ ê²°ê³¼ë¥¼ í™•ì¸í• 
ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œë¶€í„°ëŠ” LLMì˜ ì˜ì—­ì¸ 'ë¬¼ìƒë¡ ' ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì•¼ í•  ë•Œì…ë‹ˆë‹¤.
