# ì‚¬ì£¼ ë¶„ì„ ì—”ì§„ (Fortune Engine)

> 30ë…„ ëª…ë¦¬í•™ ê±°ì¥ì´ ì¸ì •í•œ AI ì‚¬ì£¼ ë¶„ì„ ì„œë¹„ìŠ¤ì˜ í•µì‹¬ ì—”ì§„

---

## ğŸ“ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        3-Layer Architecture                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Client Layer]     Next.js 14 (App Router)                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  - React Components (src/components/)                           â”‚
â”‚  - Zustand Store (src/stores/)                                  â”‚
â”‚  - TanStack Query (ìºì‹±/í´ë§)                                    â”‚
â”‚                                                                  â”‚
â”‚  [API Layer]        Next.js API Routes + Python FastAPI         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  - /api/analysis/*  â†’ Python ë¹„ë™ê¸° íŒŒì´í”„ë¼ì¸                    â”‚
â”‚  - /api/user/*      â†’ Supabase Auth/Credits                     â”‚
â”‚                                                                  â”‚
â”‚  [Service Layer]    Python Backend (Railway)                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  - ManseryeokEngine â†’ ë§Œì„¸ë ¥ ê³„ì‚°                                â”‚
â”‚  - GeminiService    â†’ AI ë¶„ì„ (gemini-3.0-preview)              â”‚
â”‚  - PromptBuilder    â†’ ë‹¤êµ­ì–´ í”„ë¡¬í”„íŠ¸ ìƒì„±                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ë¶„ì„ íŒŒì´í”„ë¼ì¸

4ê°€ì§€ ë¶„ì„ ì„œë¹„ìŠ¤ ì œê³µ:

| ì„œë¹„ìŠ¤ | ë‹¨ê³„ | í¬ë ˆë”§ | ìƒì„¸ ë¬¸ì„œ |
|--------|------|--------|----------|
| **ë¦¬í¬íŠ¸ ë¶„ì„** | 11ë‹¨ê³„ | 70C | [report_analysis.md](./report_analysis.md) |
| **ì‹ ë…„ ë¶„ì„** | 9ë‹¨ê³„ | 50C | [yearly_analysis.md](./yearly_analysis.md) |
| **ê¶í•© ë¶„ì„** | 10ë‹¨ê³„ | 70C | [compatibility.md](./compatibility.md) |
| **ìƒë‹´ AI** | 2ë‹¨ê³„ | 10C/ì§ˆë¬¸ | [consultation.md](./consultation.md) |

**ê³µí†µ íŠ¹ì§•**:
- ë¹„ë™ê¸° Job Store íŒ¨í„´ (í´ë§ ê¸°ë°˜)
- Gemini ë‹¨ê³„ë³„ 3íšŒ ì¬ì‹œë„
- Supabase DB ì¤‘ê°„ ì €ì¥ (í¬ë˜ì‹œ ë³µêµ¬)

---

## âš™ï¸ ë§Œì„¸ë ¥ ì—”ì§„

**íŒŒì¼**: `python/manseryeok/engine.py`

### ì‚¬ì£¼ íŒ”ì ê³„ì‚°

| ê¸°ë‘¥ | ê¸°ì¤€ | ê·œì¹™ |
|------|------|------|
| ì—°ì£¼(å¹´æŸ±) | ì…ì¶˜(ç«‹æ˜¥) | ì…ì¶˜ ì „ ì¶œìƒ â†’ ì „ë…„ë„ ê°„ì§€ |
| ì›”ì£¼(æœˆæŸ±) | ì ˆì…(ç¯€å…¥) ì‹œê° | 24ì ˆê¸° ê¸°ì¤€ |
| ì¼ì£¼(æ—¥æŸ±) | ìì‹œ(å­æ™‚, 23:00) | 23:00 ì´í›„ â†’ ë‹¤ìŒë‚  ì¼ì£¼ |
| ì‹œì£¼(æ™‚æŸ±) | 12ì‹œì§„ | 2ì‹œê°„ ë‹¨ìœ„ ì§€ì§€ ë°°ì • |

### ëŒ€ìš´ ê³„ì‚°

```python
def calculate_daewun(gender, year_stem):
    """
    ì–‘ë‚¨ìŒë…€: ìˆœí–‰ (ì›”ì£¼ ë‹¤ìŒ ê°„ì§€ë¡œ)
    ìŒë‚¨ì–‘ë…€: ì—­í–‰ (ì›”ì£¼ ì´ì „ ê°„ì§€ë¡œ)
    """
```

**DaewunItem í•„ë“œ**:

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `age` | int | ì‹œì‘ ë‚˜ì´ |
| `endAge` | int | ì¢…ë£Œ ë‚˜ì´ (age + 9) |
| `stem` | str | ì²œê°„ |
| `branch` | str | ì§€ì§€ |
| `tenGod` | str | ì‹­ì‹  (ì¼ê°„ ê¸°ì¤€) |
| `tenGodType` | str | ì‹­ì‹  ìœ í˜• (ë¹„ê²ìš´/ì‹ìƒìš´/ì¬ì„±ìš´/ê´€ì„±ìš´/ì¸ì„±ìš´) |
| `favorablePercent` | int | ìˆœí’ìš´ ë¹„ìœ¨ (AI ë¶„ì„) |
| `description` | str | ëŒ€ìš´ ì„¤ëª… (AI ë¶„ì„) |

### ì§€ì¥ê°„ (æ”¯è—å¹²)

| ì§€ì§€ | ì§€ì¥ê°„ (ì—¬ê¸°/ì¤‘ê¸°/ì •ê¸°) |
|------|------------------------|
| å­ | ç™¸ |
| ä¸‘ | ç™¸, è¾›, å·± |
| å¯… | æˆŠ, ä¸™, ç”² |
| å¯ | ä¹™ |
| è¾° | ä¹™, ç™¸, æˆŠ |
| å·³ | æˆŠ, åºš, ä¸™ |
| åˆ | å·±, ä¸ |
| æœª | ä¸, ä¹™, å·± |
| ç”³ | å·±, å£¬, åºš |
| é…‰ | è¾› |
| æˆŒ | è¾›, ä¸, æˆŠ |
| äº¥ | æˆŠ, ç”², å£¬ |

### API ì—”ë“œí¬ì¸íŠ¸

```
POST /api/manseryeok/calculate

Request:
{
  "birthDatetime": "1990-05-15T14:30:00",
  "timezone": "GMT+9",
  "isLunar": false,
  "gender": "male"
}

Response:
{
  "pillars": { "year": {...}, "month": {...}, "day": {...}, "hour": {...} },
  "daewun": [...],
  "jijanggan": { "year": [...], "month": [...], "day": [...], "hour": [...] }
}
```

---

## ğŸ§® ì ìˆ˜ ì‹œìŠ¤í…œ

**íŒŒì¼**: `python/scoring/calculator.py` (ì‹¤ì œ ì‚¬ìš©)

> **ì°¸ê³ **: TypeScript ë²„ì „(`src/lib/score/`)ì€ ë ˆê±°ì‹œ. Python ë²„ì „ì´ ì‹¤ì œ ì ìˆ˜ ê³„ì‚° ë‹´ë‹¹.

### ì ìˆ˜ ê³„ì‚° ê³µì‹ (v4.0)

3ê°€ì§€ Phase ì ìš©ìœ¼ë¡œ ì „í†µ ëª…ë¦¬í•™ ì •í™•ë„ í–¥ìƒ:

```python
# ìƒìˆ˜
BASE_SCORE = 50

# Phase 1: ì‹­ì‹  ì¶”ì¶œ (ì§€ì¥ê°„ ì›”ë¥ ë¶„ì•¼ ë¹„ìœ¨ ì ìš©)
ten_god_counts = _extract_ten_god_counts(pillars, jijanggan)
# - ì²œê°„/ì§€ì§€: ê°€ì¤‘ì¹˜ 1.0
# - ì§€ì¥ê°„: å¯…ç”³å·³äº¥=[7/30, 7/30, 16/30], å¯é…‰å­=[10/30, 0, 20/30]...

# Phase 2: 12ìš´ì„± ë³´ë„ˆìŠ¤ ê³„ì‚°
wunseong_bonus = calculate_wunseong_bonus(pillars)
# - ê±´ë¡/ì œì™•: +0.6, ì¥ìƒ: +0.3, ë¬˜/ì ˆ/ì‚¬: -0.4

# Phase 3: ì§€ì§€ ìƒí˜¸ì‘ìš© ë°°ìˆ˜
interaction_modifier = calculate_interaction_modifier(pillars)
# - ì¶©: 1.4, í˜•: 1.5, ì›ì§„: 0.8, íŒŒ/í•´: 0.5

# ì ìˆ˜ ê³µì‹
raw_score = 50 + Î£(modifier Ã— count) + wunseong_bonus Ã— 5
delta = raw_score - 50
final_score = 50 + delta Ã— interaction_modifier
return max(0, min(100, int(round(final_score))))
```

**Phaseë³„ íš¨ê³¼**:
| Phase | ìš”ì†Œ | íš¨ê³¼ |
|-------|------|------|
| 1 | ì§€ì¥ê°„ ì›”ë¥ ë¶„ì•¼ | ì‹­ì‹  ì¹´ìš´íŠ¸ ì •ë°€í™” (ì—¬ê¸°/ì¤‘ê¸°/ì •ê¸° ë¹„ìœ¨) |
| 2 | 12ìš´ì„± ê°€ì¤‘ì¹˜ | ê±´ë¡/ì œì™• +3ì , ë¬˜/ì ˆ/ì‚¬ -2ì  |
| 3 | ì§€ì§€ ìƒí˜¸ì‘ìš© | ì¶©/í˜• ì‹œ í¸ì°¨ ì¦í­ (1.04~1.08ë°°) |

**modifier ë²”ìœ„**:
| ì¹´í…Œê³ ë¦¬ | ë²”ìœ„ |
|---------|------|
| ì„±ê²© (PERSONALITY) | max Â±20 |
| ì—…ë¬´ (WORK) | max Â±30 |
| ì ì„± (APTITUDE) | max Â±20 |
| ì—°ì•  (LOVE) | max Â±30 |

**12ìš´ì„± ê°€ì¤‘ì¹˜**:
| ìš´ì„± | ê°€ì¤‘ì¹˜ | ìš´ì„± | ê°€ì¤‘ì¹˜ |
|------|--------|------|--------|
| ê±´ë¡/ì œì™• | +0.6 | ê´€ëŒ€ | +0.4 |
| ì¥ìƒ | +0.3 | ì–‘ | +0.2 |
| ëª©ìš• | +0.1 | íƒœ | 0 |
| ì‡  | -0.1 | ë³‘ | -0.2 |
| ë¬˜/ì ˆ/ì‚¬ | -0.4 | | |

### ì‹­ì‹ (åç¥) ì •ì˜

| ì‹­ì‹  | ê´€ê³„ | ì„±ê²© íŠ¹ì„± |
|------|------|----------|
| ë¹„ê²¬ | ê°™ì€ ì˜¤í–‰, ê°™ì€ ìŒì–‘ | ë…ë¦½ì‹¬, ê²½ìŸì‹¬, ìì¡´ì‹¬ |
| ê²ì¬ | ê°™ì€ ì˜¤í–‰, ë‹¤ë¥¸ ìŒì–‘ | ì¶”ì§„ë ¥, ìŠ¹ë¶€ìš•, ê²°ë‹¨ë ¥ |
| ì‹ì‹  | ë‚´ê°€ ìƒí•˜ëŠ” ì˜¤í–‰, ê°™ì€ ìŒì–‘ | í‘œí˜„ë ¥, ì—¬ìœ , ë‚™ì²œì„± |
| ìƒê´€ | ë‚´ê°€ ìƒí•˜ëŠ” ì˜¤í–‰, ë‹¤ë¥¸ ìŒì–‘ | ì°½ì˜ì„±, ë°˜í•­, ì˜ˆë¦¬í•¨ |
| ì •ì¬ | ë‚´ê°€ ê·¹í•˜ëŠ” ì˜¤í–‰, ë‹¤ë¥¸ ìŒì–‘ | ì•ˆì •, ì„±ì‹¤, ê·¼ë©´ |
| í¸ì¬ | ë‚´ê°€ ê·¹í•˜ëŠ” ì˜¤í–‰, ê°™ì€ ìŒì–‘ | ì‚¬êµì„±, íˆ¬ì, ë³€ë™ |
| ì •ê´€ | ë‚˜ë¥¼ ê·¹í•˜ëŠ” ì˜¤í–‰, ë‹¤ë¥¸ ìŒì–‘ | ì±…ì„ê°, ëª…ì˜ˆ, ì›ì¹™ |
| í¸ê´€ | ë‚˜ë¥¼ ê·¹í•˜ëŠ” ì˜¤í–‰, ê°™ì€ ìŒì–‘ | ê¶Œë ¥, ì¹´ë¦¬ìŠ¤ë§ˆ, ê²°ë‹¨ |
| ì •ì¸ | ë‚˜ë¥¼ ìƒí•˜ëŠ” ì˜¤í–‰, ë‹¤ë¥¸ ìŒì–‘ | í•™ìŠµ, ì¸ë‚´, í¬ìš©ë ¥ |
| í¸ì¸ | ë‚˜ë¥¼ ìƒí•˜ëŠ” ì˜¤í–‰, ê°™ì€ ìŒì–‘ | ì§ê´€, ë…ì°½ì„±, ì „ë¬¸ì„± |

### 35ê°œ íŠ¹ì„± í•­ëª©

| ì¹´í…Œê³ ë¦¬ | í•­ëª© |
|---------|------|
| ì„±ê²© (10) | ì˜ì§€ë ¥, ì‚¬êµì„±, ì¸ë‚´ë ¥, ë…ë¦½ì‹¬, ì‹ ë¢°ì„±, ë°°ë ¤ì‹¬, ìœ ë¨¸ê°ê°, í˜‘ë™ì‹¬, í‘œí˜„ë ¥, ì„±ì‹¤ë„ |
| ì—…ë¬´ (5) | ê¸°íšë ¥, ì¶”ì§„ë ¥, ì‹¤í–‰ë ¥, ì™„ì„±ë„, ê´€ë¦¬ë ¥ |
| ì ì„± (10) | ë¶„ì„ë ¥, í˜‘ë™ì‹¬, í•™ìŠµë ¥, ì°½ì˜ë ¥, ì˜ˆìˆ ì„±, í‘œí˜„ë ¥, í™œë™ì„±, ë„ì „ì •ì‹ , ì‚¬ì—…ê°ê°, ì‹ ë¢°ì„± |
| ì—°ì•  (10) | ë°°ë ¤ì‹¬, ìœ ë¨¸ê°ê°, ê°ì„±, ìì¡´ê°, ëª¨í—˜ì‹¬, ì„±ì‹¤ë„, ì‚¬êµì„±, ê²½ì œê´€ë…, ì‹ ë¢°ì„±, í‘œí˜„ë ¥ |

---

## ğŸ’‘ ê¶í•© ì—”ì§„

**íŒŒì¼**: `python/manseryeok/compatibility_engine.py`

> ìƒì„¸ ë¬¸ì„œ: [compatibility.md](./compatibility.md)

### ì ìˆ˜ ì²´ê³„ (5ê°œ í•­ëª©)

| í•­ëª© | ê°€ì¤‘ì¹˜ | ê³„ì‚° ë¡œì§ |
|------|--------|----------|
| ì²œê°„ ì¡°í™” | 25% | 5í•© ì„±ë¦½ë¥  (ê°‘ê¸°í•©í† , ì„ê²½í•©ê¸ˆ...) |
| ì§€ì§€ ì¡°í™” | 25% | 6í•© - ì¶©Ã—1.4 - í˜•Ã—1.5 - íŒŒ/í•´ |
| ì˜¤í–‰ ê· í˜• | 20% | ë³´ì™„ ì˜¤í–‰ +12, ê³¼ë‹¤ ì˜¤í–‰ -8 |
| ì‹­ì‹  í˜¸í™˜ | 20% | `TEN_GOD_COMPATIBILITY` ë§¤íŠ¸ë¦­ìŠ¤ |
| 12ìš´ì„± ì‹œë„ˆì§€ | 10% | Cross-evaluation (Aì˜ ì¼ê°„ â†’ Bì˜ ì¼ì§€) |

### í•µì‹¬ ë¡œì§: 12ìš´ì„± êµì°¨ í‰ê°€

```python
# ì¼ë°˜ ì‚¬ì£¼ë¶„ì„: ë³¸ì¸ ì¼ê°„ â†’ ë³¸ì¸ ì§€ì§€
wunseong = JIBYEON_12WUNSEONG[day_stem][day_branch]

# ê¶í•©ë¶„ì„: Aì˜ ì¼ê°„ â†’ Bì˜ ì¼ì§€ (ìƒëŒ€ë°© ê¸°ì¤€)
wunseong_a = JIBYEON_12WUNSEONG[day_stem_a][day_branch_b]  # Aê°€ Bì—ê²Œì„œ ëŠë¼ëŠ” ì—ë„ˆì§€
wunseong_b = JIBYEON_12WUNSEONG[day_stem_b][day_branch_a]  # Bê°€ Aì—ê²Œì„œ ëŠë¼ëŠ” ì—ë„ˆì§€
```

### ì—°ì•  ìŠ¤íƒ€ì¼ 5í•­ëª©

| í•­ëª© | ì˜ë¬¸ í‚¤ | ì‹­ì‹  ë§¤í•‘ |
|------|---------|----------|
| í‘œí˜„ë ¥ | expression | ì‹ì‹ Ã—1.5, ìƒê´€Ã—1.3 |
| ë…ì ìš• | possessiveness | í¸ê´€Ã—1.5, ê²ì¬Ã—1.3 |
| í—Œì‹ ë„ | devotion | ì •ì¸Ã—1.5, ì •ì¬Ã—1.3 |
| ëª¨í—˜ì‹¬ | adventure | í¸ì¬Ã—1.5, ìƒê´€Ã—1.3 |
| ì•ˆì •ì¶”êµ¬ | stability | ì •ê´€Ã—1.5, ì •ì¸Ã—1.3 |

---

## ğŸ¤– Gemini AI ì„¤ì •

**íŒŒì¼**: `python/services/gemini.py`

```python
self.model = genai.GenerativeModel(
    model_name="gemini-2.0-flash",
    generation_config={
        "temperature": 0.7,
        "top_p": 0.95,
        "max_output_tokens": 8192,
    }
)
```

### response_schema + ì—ëŸ¬ í”¼ë“œë°± (v2.7)

JSON ì‘ë‹µ 100% ê°•ì œ + ì¬ì‹œë„ ì‹œ ì—ëŸ¬ í”¼ë“œë°±:

```python
# gemini.py - generate_with_schema()
async def generate_with_schema(prompt, response_schema, previous_error=None):
    if previous_error:
        prompt += f"\n\n[ì´ì „ ì‹œë„ ì‹¤íŒ¨]\nì˜¤ë¥˜: {previous_error}"

    return await self.model.generate_content_async(
        prompt,
        generation_config=GenerationConfig(
            response_mime_type="application/json",
            response_schema=response_schema,  # JSON êµ¬ì¡° ê°•ì œ
        ),
        safety_settings={...}  # ì‚¬ì£¼ ì½˜í…ì¸  false positive ë°©ì§€
    )
```

**ìŠ¤í‚¤ë§ˆ íŒŒì¼**: `python/schemas/gemini_schemas.py`

### response_schema ì œì•½ì‚¬í•­ (v2.8)

**ì¤‘ìš”**: Gemini response_schemaëŠ” í‘œì¤€ JSON Schemaê°€ ì•„ë‹˜!

| ì§€ì› O | ì§€ì› X |
|--------|--------|
| `type` | `minimum`, `maximum` |
| `description` | `minItems`, `maxItems` |
| `properties` | `enum` |
| `items` | `pattern` |
| `required` | `format` |
| `nullable` | |

**í•´ê²°ì±…**: ë¯¸ì§€ì› í•„ë“œë¥¼ `description`ìœ¼ë¡œ ëŒ€ì²´

```python
# Before (ì˜¤ë¥˜ ë°œìƒ)
"score": {"type": "integer", "minimum": 0, "maximum": 100}

# After (ì •ìƒ ë™ì‘)
"score": {"type": "integer", "description": "0-100 ì‚¬ì´ ì ìˆ˜"}
```

### í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ

**íŒŒì¼**: `python/prompts/builder.py`

```
í”„ë¡¬í”„íŠ¸ ë¹Œë“œ íŒŒì´í”„ë¼ì¸:
[ë§ˆìŠ¤í„° í˜ë¥´ì†Œë‚˜] â†’ [ìí‰ì§„ì „] â†’ [ê¶í†µë³´ê°] â†’ [The Destiny Code] â†’ [ë¡œì¼€ì¼] â†’ [ìŠ¤í‚¤ë§ˆ]
```

**ë‹¤êµ­ì–´ ì§€ì›**: ko, en, ja, zh-CN, zh-TW (5ê°œ ì–¸ì–´)

### ê³ ì „ ëª…ë¦¬í•™ ëª¨ë“ˆ

| ëª¨ë“ˆ | íŒŒì¼ | ë‚´ìš© |
|------|------|------|
| ìí‰ì§„ì „ | `classics/ziping.py` | ìš©ì‹  5ì›ì¹™, 8ê²©, ì‹­ì‹  |
| ê¶í†µë³´ê° | `classics/qiongtong.py` | ì¡°í›„ë¡ , ì›”ë ¹ ìš©ì‹  |
| ì¡°í›„ ë§¤íŠ¸ë¦­ìŠ¤ | `classics/qiongtong_matrix.py` | 10ì¼ê°„Ã—12ì›” (120ê°œ) |
| The Destiny Code | `western/destiny_code.py` | ì„œêµ¬ê¶Œ í˜„ëŒ€í™” í”„ë ˆì„ |

---

## ğŸ¨ ì‹œê°í™” ì‹œìŠ¤í…œ

**íŒŒì¼**: `python/visualization/visualizer.py`

### ì‚¬ì£¼ ëª…ë°˜ ì´ë¯¸ì§€

- í¬ê¸°: 800x400px
- ì¶œë ¥: Base64 PNG
- API: `POST /api/visualization/pillar`

### ì˜¤í–‰ ìƒ‰ìƒ

| ì˜¤í–‰ | ë°°ê²½ìƒ‰ | í…ìŠ¤íŠ¸ìƒ‰ |
|------|--------|---------|
| æœ¨ | `#4ade80` | `#1a1a1a` |
| ç« | `#ef4444` | `#ffffff` |
| åœŸ | `#f59e0b` | `#1a1a1a` |
| é‡‘ | `#e5e7eb` | `#1a1a1a` |
| æ°´ | `#1e3a8a` | `#ffffff` |

### UI ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ | ì„¤ëª… |
|---------|------|------|
| `FavorableBar` | `src/components/report/` | ìˆœí’/ì—­í’ ë¹„ìœ¨ ë°” |
| `DaewunDetailSection` | `src/components/report/` | ëŒ€ìš´ ìƒì„¸ ì¹´ë“œ |
| `ElementRelationGraph` | `src/components/analysis/` | ì˜¤í–‰ ìƒìƒìƒê·¹ ê´€ê³„ë„ |
| `PillarDetailModal` | `src/components/analysis/` | ê¸°ë‘¥ í´ë¦­ ìƒì„¸ ëª¨ë‹¬ |
| `BasicAnalysisSection` | `src/components/report/` | ê¸°ë³¸ ë¶„ì„ (ì¼ê°„/ê²©êµ­/ìš©ì‹ ) |
| `DetailedScoresSection` | `src/components/report/` | ì„¸ë¶€ ì ìˆ˜ ë ˆì´ë” ì°¨íŠ¸ |

### ë¦¬í¬íŠ¸ ì„¹ì…˜ í™•ì¥ ë°ì´í„° (v2.3)

ê° ì„¹ì…˜ì€ `extended` propìœ¼ë¡œ ìƒì„¸ ë°ì´í„° í‘œì‹œ:

| ì„¹ì…˜ | í™•ì¥ ë°ì´í„° |
|------|-----------|
| `SajuTable` | ì§€ì¥ê°„ (ì—¬ê¸°/ì¤‘ê¸°/ì •ê¸°) í‘œì‹œ |
| `BasicAnalysisSection` | ì¼ê°„ íŠ¹ì„±, ê²©êµ­, ìš©ì‹ /ê¸°ì‹  + ì¶”ë¡  ê·¼ê±° |
| `AptitudeSection` | talents basis/level, avoidFields, talentUsage, recommendedFields suitability |
| `RomanceSection` | style, idealPartner, warnings, compatibilityPoints, loveAdvice |
| `WealthSection` | pattern, strengths, risks, advice |
| `PersonalitySection` | socialStyleDetail (type/strengths/weaknesses) |
| `DetailedScoresSection` | ì—°ì•  10í•­ëª© + ì—…ë¬´ 5í•­ëª© ë ˆì´ë” ì°¨íŠ¸ (Recharts)

---

## ğŸ“‹ íƒ€ì… ì‹œìŠ¤í…œ

### Python â†’ TypeScript ìë™ ìƒì„±

```bash
npm run generate:types
```

**íë¦„**:
```
Pydantic (Python) â†’ OpenAPI JSON â†’ TypeScript (generated.d.ts)
```

**ìƒì„± íŒŒì¼**: `src/types/generated.d.ts`

```typescript
import { Pillars, DaewunItem, Jijanggan, CalculateResponse } from '@/types';
```

### íŒŒì´í”„ë¼ì¸ íƒ€ì…

**íŒŒì¼**: `src/lib/ai/pipeline/types.ts`

```typescript
export const PIPELINE_STEPS: PipelineStep[] = [
  'manseryeok', 'jijanggan', 'basic_analysis',
  'personality', 'aptitude', 'fortune',
  'scoring', 'visualization', 'saving', 'complete'
];

export const DEFAULT_STEP_TIMEOUTS: Record<PipelineStep, number> = {
  manseryeok: 300000,     // 5ë¶„
  basic_analysis: 300000, // 5ë¶„ (Gemini)
  scoring: 60000,         // 1ë¶„
  // ...
};
```

---

## ğŸ“ í´ë” êµ¬ì¡°

```
python/
â”œâ”€â”€ main.py                 # FastAPI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”œâ”€â”€ manseryeok/             # ë§Œì„¸ë ¥ ì—”ì§„
â”œâ”€â”€ prompts/                # AI í”„ë¡¬í”„íŠ¸ (5ê°œ ì–¸ì–´)
â”‚   â”œâ”€â”€ classics/           # ìí‰ì§„ì „, ê¶í†µë³´ê°
â”‚   â””â”€â”€ western/            # The Destiny Code
â”œâ”€â”€ scoring/                # ì ìˆ˜ ê³„ì‚°
â”œâ”€â”€ services/               # ë¹„ë™ê¸° ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ report_analysis.py  # ë¦¬í¬íŠ¸ ë¶„ì„
â”‚   â”œâ”€â”€ yearly_analysis.py  # ì‹ ë…„ ë¶„ì„
â”‚   â”œâ”€â”€ normalizers.py      # Gemini ì‘ë‹µ í‚¤ ì •ê·œí™”
â”‚   â””â”€â”€ consultation_service.py
â”œâ”€â”€ schemas/                # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ report_steps.py     # ë¦¬í¬íŠ¸ ë‹¨ê³„ë³„ ê²€ì¦ ìŠ¤í‚¤ë§ˆ (v2.4)
â”‚   â””â”€â”€ yearly.py           # ì‹ ë…„ ë¶„ì„ ìŠ¤í‚¤ë§ˆ
â””â”€â”€ visualization/          # ì´ë¯¸ì§€ ìƒì„±

src/lib/
â”œâ”€â”€ ai/pipeline/            # TypeScript íŒŒì´í”„ë¼ì¸
â”‚   â”œâ”€â”€ index.ts            # AnalysisPipeline
â”‚   â”œâ”€â”€ context.ts          # PipelineContext
â”‚   â””â”€â”€ step-executor.ts    # StepExecutor
â””â”€â”€ score/                  # ì‹­ì‹  ì ìˆ˜ ê³„ì‚°
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ëª…ë¦¬í•™ ìš©ì–´

| ìš©ì–´ | í•œì | ì˜ë¬¸ | ì„¤ëª… |
|------|------|------|------|
| ì¼ê°„ | æ—¥å¹² | Day Master | ì‚¬ì£¼ì˜ ì¤‘ì‹¬, ë‚˜ ìì‹  |
| ê²©êµ­ | æ ¼å±€ | Structure | ì‚¬ì£¼ì˜ ìœ í˜•/íŒ¨í„´ |
| ìš©ì‹  | ç”¨ç¥ | Useful God | ì‚¬ì£¼ë¥¼ ë³´ì™„í•˜ëŠ” ì˜¤í–‰ |
| ëŒ€ìš´ | å¤§é‹ | Luck Cycle | 10ë…„ ë‹¨ìœ„ ìš´ì˜ íë¦„ |
| ì„¸ìš´ | æ­²é‹ | Annual Luck | ì—°ë„ë³„ ìš´ì„¸ |

### ì™¸ë¶€ ë§í¬

- [Gemini API Docs](https://ai.google.dev/docs)
- [Supabase Docs](https://supabase.com/docs)

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 2026-01-09 | v5.0 | ê¶í•© ë¶„ì„ ì‹œìŠ¤í…œ ì¶”ê°€ (10ë‹¨ê³„ íŒŒì´í”„ë¼ì¸, Python ì ìˆ˜ ì—”ì§„ + Gemini í•´ì„) |
| 2026-01-08 | v4.1 | ê¸°ë³¸ë¶„ì„ í™•ì¥ í•„ë“œ ì¶”ê°€ (dayMaster.description, structure.practicalAdvice, usefulGod.practicalApplication) |
| 2026-01-07 | v4.0 | ì ìˆ˜ ì‹œìŠ¤í…œ ê³ ë„í™” (ì§€ì¥ê°„ ì›”ë¥ ë¶„ì•¼ ë¹„ìœ¨, 12ìš´ì„± ê°€ì¤‘ì¹˜, ì§€ì§€ ìƒí˜¸ì‘ìš© ë°°ìˆ˜, SENSITIVITY ì œê±°) |
| 2026-01-07 | v3.0 | ì ìˆ˜ ë¶„í¬ ê·¹ë‹¨í™” (SENSITIVITY=1.5 í¸ì°¨ ì¦í­, modifier Ã—1.8, ì§€ì¥ê°„ ì—¬ê¸°/ì¤‘ê¸° ê°€ì¤‘ì¹˜ 0) |
| 2026-01-07 | v2.5 | response_schema ë¯¸ì§€ì› í•„ë“œ ì œê±° (minimum, maximum, minItems, enum â†’ description) |
| 2026-01-07 | v2.4 | Normalizeâ†’Validate íŒŒì´í”„ë¼ì¸, Pydantic ìŠ¤í‚¤ë§ˆ ê²€ì¦, ì¬ë¶„ì„ API (0C) |
| 2026-01-07 | v2.3 | ë¦¬í¬íŠ¸ UI í™•ì¥ (ì§€ì¥ê°„/ê¸°ë³¸ë¶„ì„/ë ˆì´ë”ì°¨íŠ¸/ì„¹ì…˜ë³„ extended ë°ì´í„°) |
| 2026-01-07 | v2.2 | ë¬¸ì„œ 4ê°œ ë¶„ë¦¬ (report/yearly/consultation) |
| 2026-01-06 | v2.1 | ìƒë‹´ í”„ë¡¬í”„íŠ¸ ê°œì„  (ì¬ì§ˆë¬¸ ê¸ˆì§€) |
| 2026-01-05 | v2.0 | ë¹„ë™ê¸° íŒŒì´í”„ë¼ì¸, Job Store íŒ¨í„´ |
| 2026-01-05 | v1.31 | í¬ë ˆë”§ ê°€ê²© ë³€ê²½ |
| 2026-01-05 | v1.30 | Crisp ì‹¤ì‹œê°„ ì±„íŒ… ë„ì… |

---

**ìµœì¢… ìˆ˜ì •**: 2026-01-09 (v5.0)
