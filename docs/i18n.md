# 다국어(i18n) 시스템

> next-intl 기반 5개 언어 지원 (ko, en, ja, zh-CN, zh-TW)

## 핵심 원칙

> **리포트 결과는 분석 시점 언어로 DB 저장 (나중에 번역 X)**

- UI 라벨(섹션 제목, 탭명)만 동적 다국어화
- AI 분석 결과는 저장된 언어 그대로 표시

---

## 핵심 파일 위치

| 구분 | 파일 |
|------|------|
| 라우팅 설정 | `src/i18n/routing.ts` |
| 서버 요청 | `src/i18n/request.ts` |
| 미들웨어 | `src/middleware.ts` |
| 메시지 파일 | `locales/{ko,en,ja,zh-CN,zh-TW}.json` |
| Python 다국어 | `python/prompts/locale_strings.py` |

---

## 사용 패턴 (Quick Reference)

```typescript
// 클라이언트
import { useTranslations, useLocale } from 'next-intl';
const t = useTranslations('namespace');
const locale = useLocale();

// 서버
import { getTranslations } from 'next-intl/server';
const t = await getTranslations({ locale, namespace: 'metadata' });

// 네비게이션 (next/link 대신)
import { Link, useRouter } from '@/i18n/routing';

// 배열 메시지
const tips = t.raw('tips') as string[];
```

---

## Todo 리스트

### Phase 1: API Language 동적 전달 ✅ 완료

| Task | 파일 | 상태 |
|------|------|------|
| 1.1 Report API | `src/app/api/profiles/[id]/report/route.ts` | ✅ |
| 1.1 Report 프론트 | `src/app/[locale]/profiles/[id]/generating/page.tsx` | ✅ |
| 1.2 Yearly | `src/app/[locale]/analysis/yearly/processing/page.tsx` | ✅ |
| 1.3 Compatibility | `src/app/[locale]/compatibility/romance/new/page.tsx` | ✅ |

> **참고**: `useLocale()` → API body `language` → Python 패턴 적용

---

### Phase 2: UI 라벨 다국어화

| Task | 파일 | 상태 |
|------|------|------|
| 2.1 Report 탭/섹션 | `ReportNavigation.tsx`, `PersonalitySection.tsx`, `DaewunDetailSection.tsx` 등 | ⏳ |
| 2.2 Yearly 섹션 | `YearlyAdviceCard.tsx`, `MonthlyTimeline.tsx`, `FailedSectionCard.tsx` | ✅ |
| 2.3 Compatibility | `src/app/[locale]/compatibility/*/page.tsx` | ⏳ |

> **2.2 완료 (2026-01-14)**: 6개 섹션 라벨, 상반기/하반기 탭, 월별 타임라인, 실패 섹션 카드 다국어화

### Phase 3: 결제 페이지

| Task | 파일 |
|------|------|
| 3.1 결제 페이지 | `src/app/[locale]/payment/page.tsx` |
| 3.2 결제수단 라벨 | `src/lib/portone.ts` |
| 3.3 결제 성공 | `src/app/[locale]/payment/success/page.tsx` |
| 3.4 locales 확장 | `locales/*.json` payment 섹션 |

### Phase 4: 공통 및 마무리

| Task | 파일 |
|------|------|
| 4.1 크레딧 다이얼로그 | `src/components/credits/CreditDeductionDialog.tsx` |
| 4.2 Python 확장 | `python/prompts/locale_strings.py`, `compatibility_prompts.py` |
| 4.3 locales 동기화 | 5개 JSON 누락 키 검출 |

---

**Version**: 2.1.0
**Last Updated**: 2026-01-14
