# 다국어(i18n) 시스템

> next-intl 기반 5개 언어 지원 (ko, en, ja, zh-CN, zh-TW)

## 핵심 원칙

> **리포트 결과는 분석 시점 언어로 DB 저장 (나중에 번역 X)**

- UI 라벨(섹션 제목, 탭명)만 동적 다국어화
- AI 분석 결과는 저장된 언어 그대로 표시

---

## 핵심 파일 위치

| 구분 | 파일 |
|------|------|
| 라우팅 설정 | `src/i18n/routing.ts` |
| 서버 요청 | `src/i18n/request.ts` |
| 미들웨어 | `src/middleware.ts` |
| 메시지 파일 | `locales/{ko,en,ja,zh-CN,zh-TW}.json` |
| Python 다국어 | `python/prompts/locale_strings.py` |

---

## 사용 패턴 (Quick Reference)

```typescript
// 클라이언트
import { useTranslations, useLocale } from 'next-intl';
const t = useTranslations('namespace');
const locale = useLocale();

// 서버
import { getTranslations } from 'next-intl/server';
const t = await getTranslations({ locale, namespace: 'metadata' });

// 네비게이션 (next/link 대신)
import { Link, useRouter } from '@/i18n/routing';

// 배열 메시지
const tips = t.raw('tips') as string[];
```

---

## Todo 리스트

### Phase 1: API Language 동적 전달 ✅ 완료

| Task | 파일 | 상태 |
|------|------|------|
| 1.1 Report API | `src/app/api/profiles/[id]/report/route.ts` | ✅ |
| 1.1 Report 프론트 | `src/app/[locale]/profiles/[id]/generating/page.tsx` | ✅ |
| 1.2 Yearly | `src/app/[locale]/analysis/yearly/processing/page.tsx` | ✅ |
| 1.3 Compatibility | `src/app/[locale]/compatibility/romance/new/page.tsx` | ✅ |

> `useLocale()` → API body `language` → Python 패턴 적용

---

### Phase 2: UI 라벨 다국어화

| Task | 파일 | 상태 |
|------|------|------|
| 2.1 Report 탭/섹션 | `ReportNavigation.tsx`, `PersonalitySection.tsx`, `DaewunDetailSection.tsx`, `RomanceSection.tsx`, `AptitudeSection.tsx` | ✅ |
| 2.2 Yearly 섹션 | `YearlyAdviceCard.tsx`, `MonthlyTimeline.tsx`, `FailedSectionCard.tsx` | ✅ |
| 2.3 Compatibility | `page.tsx`, `new/page.tsx`, `[id]/page.tsx`, `generating/page.tsx` | ✅ |

> **2.1 완료**: 네비게이션 탭(사주/대운/상담), 성격 섹션(강점/약점), 대운 섹션(설명/시작일/분석대기), 연애 섹션(이상형/주의사항), 적성 섹션(재능활용/추천직종) 다국어화
> **2.2 완료**: 6개 섹션 라벨, 상반기/하반기 탭, 월별 타임라인, 실패 섹션 다국어화
> **2.3 완료**: 궁합 메인/생성/결과/로딩 페이지 전체 다국어화

### Phase 3: 결제 페이지 ✅ 완료

| Task | 파일 | 상태 |
|------|------|------|
| 3.1 결제 페이지 | `src/app/[locale]/payment/page.tsx` | ✅ |
| 3.2 결제수단 라벨 | `locales/*.json` payment.methods | ✅ |
| 3.3 결제 성공 | `src/app/[locale]/payment/success/page.tsx` | ✅ |
| 3.4 locales 확장 | `locales/zh-TW.json` paymentSuccess 추가 | ✅ |

> **3.1~3.3 완료**: useTranslations 적용, 하드코딩 텍스트 제거, PAYMENT_METHOD_META + locales 분리
> **3.4 완료**: zh-TW.json에 paymentSuccess 섹션 추가 (누락된 유일한 언어)

### Phase 4: 공통 및 마무리 ✅ 완료

| Task | 파일 | 상태 |
|------|------|------|
| 4.1 크레딧 다이얼로그 | `src/components/credits/CreditDeductionDialog.tsx` | ✅ |
| 4.2 Python 확장 | `python/prompts/locale_strings.py` | ✅ (이미 완료) |
| 4.3 locales 동기화 | 5개 JSON 누락 키 검출 | ✅ |

> **4.1 완료**: `tCommon('free')` 적용하여 "0C (무료)" 하드코딩 제거
> **4.2 완료**: `locale_strings.py`는 이미 5개 언어 지원 중. `compatibility_prompts.py`는 AI 프롬프트 참조용으로 현행 유지
> **4.3 완료**: 15개 누락 키 동기화 (`analysis.processing.*`, `analysis.tabs.*`, `report.detailedScores.*`, `dailyFortune.retry`)

---

**Version**: 2.7.0
**Last Updated**: 2026-01-14 (Phase 4 전체 완료)
