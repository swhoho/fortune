# Master's Insight AI - PRD v2.0

> 30년 명리학 거장이 인정한 AI 사주 분석 서비스 (버전 2.0)

**Version**: 2.0.0  
**Last Updated**: 2026-01-03  

---

## 1. 개요 (Overview)

### 1.1 비전
기존 v1.x 시스템을 확장하여, 다수 프로필 관리 + 깊이 있는 상세 리포트를 제공하는 AI 사주 분석 서비스.

### 1.2 핵심 개선 목표 (v2.0)

| 항목 | 현재 (v1.x) | 목표 (v2.0) |
|------|-------------|-------------|
| 진입점 | 바로 분석 진입 | **허브 형태 홈화면** + 다수 프로필 관리 |
| 사용자 정보 | 최소 정보 | 이름, 생일, 성별 완전 지원 |
| 리포트 깊이 | 5개 탭 (단일 분석) | **10+ 섹션** (파트별 상세 분석) |
| 시각화 | 명반 이미지 + 오행 차트 | **다양한 특성 그래프 + 점수 시각화** |
| 분석 엔진 | 단일 Gemini 호출 | **멀티스텝 분석** (Context 분산) |

### 1.3 핵심 원칙

1. **기존 시스템 기반**: v1.x의 만세력 엔진, AI 분석기, 컴포넌트 최대 활용
2. **차별화된 UX**: 레퍼런스 앱 구조 참고하되, 독자적 디자인 & 브랜딩
3. **RAG 미사용**: 고전 문헌 핵심 이론을 프롬프트에 직접 임베딩
4. **멀티스텝 분석**: Context 길이 문제 해결을 위해 섹션별 분리 호출

### 1.4 레퍼런스 참고 범위

| 참고 O | 참고 X |
|--------|--------|
| 리포트 구조/섹션 구성 | 보라색 그라데이션 디자인 |
| 특성 그래프 개념 | "지피지기" 네이밍 |
| 다수 프로필 관리 개념 | 동일한 UI 컴포넌트 |

**우리만의 디자인 방향**:
- 기존 브랜드 컬러 유지 (금색 #d4af37, 먹색 #1a1a1a)
- 모던하고 미니멀한 UI
- 카드 기반 레이아웃

---

## 2. 용어 정의

| 레퍼런스 앱 | 우리 서비스 | 설명 |
|------------|------------|------|
| 지인 등록 | **프로필 등록** | 사주 분석할 사람 등록 |
| 지인 목록 | **프로필 목록** | 등록된 프로필 리스트 |
| 지피지기 | Master's Insight | 서비스명 |
| 사주풀이 | **사주 리포트** | 분석 결과 문서 |

---

## 3. 사용자 플로우 (User Flow)

### 3.1 홈 화면 (신규)

**참조 구조**: `/docs/reference/Home.PNG` (구조만 참고)

```
┌─────────────────────────────────────────┐
│           Master's Insight              │
│              AI 사주 분석                │
├─────────────────────────────────────────┤
│                                         │
│  📋 나의 프로필                          │
│  ┌─────────────────────────────────┐   │
│  │  + 새 프로필 등록                 │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │  👤 등록된 프로필 보기 (3)        │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ✨ 빠른 분석                           │
│  ┌─────────────────────────────────┐   │
│  │  🎯 지금 바로 분석하기            │   │
│  └─────────────────────────────────┘   │
│                                         │
│  🌙 2026년 신년 운세                    │
│  ┌─────────────────────────────────┐   │
│  │  📅 신년 운세 보기                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  💑 궁합 분석 (Coming Soon)            │
│  ┌─────────────────────────────────┐   │
│  │  🔒 곧 출시 예정                  │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 3.2 프로필 등록 화면

**참조 구조**: `/docs/reference/register.PNG` (입력 필드 참고)

```
┌─────────────────────────────────────────┐
│  ←          프로필 등록            저장  │
├─────────────────────────────────────────┤
│                                         │
│  이름                                   │
│  ┌─────────────────────────────────┐   │
│  │  홍길동                          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  생년월일                               │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐  │
│  │  1991   │ │   11    │ │   25    │  │
│  └─────────┘ └─────────┘ └─────────┘  │
│                                         │
│  태어난 시간 (선택)                      │
│  ┌─────────┐ ┌─────────┐              │
│  │   03    │ │   30    │              │
│  └─────────┘ └─────────┘              │
│                                         │
│  달력 유형                              │
│  ○ 양력  ● 음력  ○ 음력(윤달)           │
│                                         │
│  성별                                   │
│  ● 남성      ○ 여성                     │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │         프로필 저장              │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

### 3.3 프로필 목록 화면

**참조 구조**: `/docs/reference/register_users.PNG`

```
┌─────────────────────────────────────────┐
│  ←        나의 프로필           + 추가  │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 👤 여호정                        │   │
│  │    1991.11.25 (36세) · 남성      │   │
│  │    [리포트 보기] [편집]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 👤 김철수                        │   │
│  │    1985.03.15 (41세) · 남성      │   │
│  │    [리포트 보기] [편집]          │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

---

## 4. 리포트 구조 (Report Structure)

### 4.1 전체 리포트 섹션 (레퍼런스 참고)

**참조**: `/docs/reference/fortune1.PNG` ~ `fortune11.PNG`

```
사주 리포트
├── 1. 사주 명식 (4주 + 대운) ─────────── fortune1.PNG
├── 2. 성격 분석
│   ├── 의지력 게이지 ─────────────────── fortune1.PNG
│   ├── 겉으로 보이는 성격 ────────────── fortune2.PNG
│   ├── 내면의 성격 ───────────────────── fortune2.PNG
│   └── 대인관계 스타일 ───────────────── fortune2.PNG
├── 3. 사주 특성 (문단 분석) ───────────── fortune3.PNG
├── 4. 성격 특성 그래프 (10개) ─────────── fortune4.PNG
├── 5. 적성과 재능
│   ├── 핵심 키워드 ───────────────────── fortune5.PNG
│   ├── 주요 재능 ─────────────────────── fortune5.PNG
│   ├── 재능 활용 상태 ────────────────── fortune6.PNG
│   ├── 커리어 방향 ───────────────────── fortune6.PNG
│   └── 추천 분야 ─────────────────────── fortune7.PNG
├── 6. 업무 능력 그래프 (5개) ──────────── fortune8.PNG
├── 7. 적성 특성 그래프 (10개) ─────────── fortune8.PNG
├── 8. 재물운 ─────────────────────────── fortune9.PNG
├── 9. 연애/결혼운
│   ├── 연애 스타일 ───────────────────── fortune10.PNG
│   └── 이상형 & 결혼관 ───────────────── fortune10.PNG
└── 10. 연애 특성 그래프 (10개) ────────── fortune11.PNG
```

### 4.2 그래프 항목 정의

**성격 특성 그래프 (10개)** - fortune4.PNG
```
의지력, 사교성, 인내력, 독립심, 신뢰성,
배려심, 유머감각, 협동심, 표현력, 성실도
```

**업무 능력 그래프 (5개)** - fortune8.PNG 상단
```
기획력, 추진력, 실행력, 완성도, 관리력
```

**적성 특성 그래프 (10개)** - fortune8.PNG 하단
```
분석력, 협동심, 학습력, 창의력, 예술성,
표현력, 활동성, 도전정신, 사업감각, 신뢰성
```

**연애 특성 그래프 (10개)** - fortune11.PNG
```
배려심, 유머감각, 감성, 자존감, 모험심,
성실도, 사교성, 경제관념, 신뢰성, 표현력
```

---

## 5. 분석 엔진 설계 (핵심)

### 5.1 멀티스텝 분석 아키텍처

**왜 멀티스텝인가?**
- Gemini Context 제한으로 한 번에 깊은 분석 어려움
- 각 섹션별로 충분한 Context 확보
- 부분 실패 시 해당 섹션만 재시도 가능

```
[프로필 입력]
      │
      ▼
[Step 1: 만세력 계산] ─────────── Python API (기존)
      │
      ▼
[Step 2: 기본 분석] ──────────── Gemini 호출 #1
      │ 출력: 요약, 일간 특성, 격국 판단
      │
      ▼
[Step 3: 성격 섹션] ──────────── Gemini 호출 #2
      │ 입력: Step 1,2 결과 + 성격 프롬프트
      │ 출력: 의지력, 겉성격, 속성격, 대인관계
      │
      ▼
[Step 4: 적성 섹션] ──────────── Gemini 호출 #3
      │ 입력: Step 1,2 결과 + 적성 프롬프트
      │ 출력: 키워드, 재능, 커리어, 추천분야
      │
      ▼
[Step 5: 재물/연애 섹션] ─────── Gemini 호출 #4
      │ 입력: Step 1,2 결과 + 재물/연애 프롬프트
      │ 출력: 재물운, 연애스타일, 결혼관
      │
      ▼
[Step 6: 그래프 점수 계산] ───── 알고리즘 (십신 기반)
      │
      ▼
[Step 7: 결과 통합 & 저장]
```

### 5.2 프롬프트 내 고전 이론 임베딩 (RAG 대체)

**RAG를 사용하지 않는 이유:**
- 검색 품질 불안정
- 추가 인프라 비용
- 프롬프트에 핵심만 넣어도 충분

**대신 사용할 방식:**
1. 궁통보감, 자평진전 핵심 이론을 **프롬프트에 직접 포함**
2. 일간별, 격국별 핵심 해석 매핑 테이블
3. Python `prompts/` 디렉토리에 정리된 고전 데이터 활용

### 5.3 고전 이론 요약본 (프롬프트용)

기존 txt 파일에서 추출한 핵심 내용을 프롬프트에 포함:

```
## 자평진전 핵심 (용신론)
- 억부용신: 일간 강하면 설기, 약하면 생부
- 조후용신: 계절 한난조습 조절
- 통관용신: 대립 오행 중재
- 병약용신: 병이 있으면 약으로 치료
- 전왕용신: 한 오행이 극히 강하면 따름

## 궁통보감 핵심 (조후론)
- 寅卯월 甲木: 丙火로 따뜻하게, 癸水로 윤택하게
- 巳午월 甲木: 壬癸水로 시원하게
- 申酉월 甲木: 丁火로 금기 제어
- 亥子월 甲木: 丙火 필수, 戊土로 뿌리

## 십신 해석
- 비견: 독립심, 자존심, 경쟁
- 겁재: 추진력, 승부욕, 극단적
- 식신: 표현력, 여유, 복록
- 상관: 창의성, 반항, 예리함
- 정재: 안정, 실리, 근면
- 편재: 투자, 유통, 변동
- 정관: 책임감, 원칙, 명예
- 편관: 권력, 압박, 결단
- 정인: 학습, 보호, 전통
- 편인: 특수, 고독, 직관
```

### 5.4 점수 계산 알고리즘

십신(十神) 기반으로 각 특성 점수 계산:

```python
# 십신별 특성 영향 매핑
TRAIT_MODIFIERS = {
    'willpower': {      # 의지력
        '비견': +15, '겁재': +10,
        '식신': -5, '상관': -5,
    },
    'sociability': {    # 사교성
        '식신': +15, '상관': +10,
        '편인': -10, '정인': -5,
    },
    'patience': {       # 인내력
        '정인': +15, '편인': +10,
        '상관': -10, '겁재': -5,
    },
    # ... 나머지 특성들
}

def calculate_trait_score(pillars, trait_type):
    """십신 분포 기반 점수 계산"""
    base = 50
    ten_gods = extract_ten_gods(pillars)
    
    for god, count in ten_gods.items():
        modifier = TRAIT_MODIFIERS.get(trait_type, {}).get(god, 0)
        base += modifier * count
    
    return max(0, min(100, base))
```

---

## 6. 기존 시스템 활용 계획

### 6.1 재사용할 기존 컴포넌트

| 컴포넌트 | 위치 | 활용 방식 |
|---------|------|----------|
| PillarCard | `src/components/analysis/` | 사주명식 표시 (확장) |
| ElementChart | `src/components/analysis/` | 오행 차트 (유지) |
| AnalysisTabs | `src/components/analysis/` | 탭 구조 (확장) |
| DaewunTimeline | `src/components/analysis/` | 대운 표시 (유지) |

### 6.2 확장할 기존 시스템

| 시스템 | 현재 | 확장 |
|--------|------|------|
| 만세력 엔진 | `python/manseryeok/` | 유지 (변경 없음) |
| Gemini Analyzer | `src/lib/ai/analyzer.ts` | 멀티스텝 지원 추가 |
| Analysis Store | `src/stores/analysis.ts` | 프로필 관리 추가 |
| Result Page | `src/app/[locale]/analysis/result/` | 섹션 확장 |

### 6.3 신규 추가 필요

| 항목 | 설명 |
|------|------|
| Profile 모델 | 다수 프로필 저장 |
| Home Page | 허브 형태 진입점 |
| TraitGraph 컴포넌트 | 특성 그래프 시각화 |
| 섹션별 프롬프트 | 성격/적성/재물/연애 |
| 점수 계산 모듈 | 십신 기반 알고리즘 |

---

## 7. 데이터 모델

### 7.1 Profile (프로필)

```typescript
interface Profile {
  id: string;
  userId: string;           // 소유자
  name: string;             // 이름
  gender: 'male' | 'female';
  birthDate: Date;          // 생년월일
  birthTime?: string;       // 시:분 (선택)
  calendarType: 'solar' | 'lunar' | 'lunar_leap';
  createdAt: Date;
  updatedAt: Date;
}
```

### 7.2 ProfileReport (프로필 리포트)

```typescript
interface ProfileReport {
  id: string;
  profileId: string;
  
  // 사주 데이터 (만세력)
  pillars: PillarsHanja;
  daewun: DaewunItem[];
  
  // 섹션별 분석 결과
  basicAnalysis: BasicAnalysis;          // Step 2 결과
  personalitySection: PersonalitySection; // Step 3
  aptitudeSection: AptitudeSection;       // Step 4
  fortuneSection: FortuneSection;         // Step 5
  
  // 그래프 점수
  traitScores: TraitScores;               // Step 6
  
  createdAt: Date;
}
```

---

## 8. 기존 문서 수정 가이드

v2.0 개발 완료 후 아래 문서들 수정 필요:

### 8.1 `docs/api.md` 추가 내용

```markdown
## Profile API (v2.0 추가)

### POST /api/profiles
프로필 생성

### GET /api/profiles  
프로필 목록

### GET /api/profiles/:id
프로필 상세

### PUT /api/profiles/:id
프로필 수정

### DELETE /api/profiles/:id
프로필 삭제

### POST /api/profiles/:id/report
프로필 리포트 생성 (멀티스텝 분석)

### GET /api/profiles/:id/report
프로필 리포트 조회

### POST /api/profiles/:id/report/section/:type
특정 섹션 재분석 (5크레딧)
```

### 8.2 `docs/fortune_engine.md` 추가 내용

```markdown
## 멀티스텝 분석 파이프라인 (v2.0)

### 개요
Context 길이 문제 해결을 위해 7단계로 분리

### Step별 상세
- Step 1: 만세력 계산 (기존)
- Step 2: 기본 분석 (요약, 격국)
- Step 3: 성격 섹션
- Step 4: 적성 섹션
- Step 5: 재물/연애 섹션
- Step 6: 점수 계산
- Step 7: 결과 통합

### 프롬프트 내 고전 이론
RAG 대신 프롬프트에 직접 임베딩
- 자평진전 용신론 요약
- 궁통보감 조후론 요약
- 십신 해석 가이드

### 점수 계산 알고리즘
십신 분포 기반 특성 점수 공식
```

### 8.3 `claude.md` 추가 내용

```markdown
## v2.0 구조 변경

### 새로운 라우트
src/app/[locale]/
├── home/page.tsx           # 홈화면 (신규)
├── profiles/               # 프로필 관리 (신규)
│   ├── page.tsx
│   ├── new/page.tsx
│   └── [id]/page.tsx

### 새로운 컴포넌트
src/components/
├── profile/                # 프로필 (신규)
└── report/                 # 리포트 섹션 (신규)
    └── TraitGraph.tsx

### 새로운 API
src/app/api/
└── profiles/               # 프로필 API (신규)
```

---

## 9. 크레딧 시스템

| 서비스 | 크레딧 | USD |
|--------|--------|-----|
| 프로필 등록 | 무료 | $0 |
| 기본 리포트 | 30 C | $3.00 |
| 섹션 재분석 | 5 C | $0.50 |
| 신년 운세 | 30 C | $3.00 |
| 궁합 분석 | 50 C | $5.00 |

---

## 10. 마일스톤

| Phase | 기간 | 내용 |
|-------|------|------|
| Phase 1 | Week 1 | 홈화면 + 프로필 CRUD |
| Phase 2 | Week 2 | 멀티스텝 엔진 + 프롬프트 |
| Phase 3 | Week 3-4 | 리포트 UI 섹션 구현 |
| Phase 4 | Week 5 | 통합 테스트 + 문서화 |

---

**End of PRD v2.0**
